# Phase 7: 통합 및 마무리

## 목표

7개 기능의 상호작용을 검증하고, CLAUDE.md를 갱신하며, 전체 회귀 테스트를 수행한다.

## 선행 조건

- Phase 1~6 모두 완료

## 아키텍처 참조

- SRS §2.8 기능 간 상호작용 매트릭스

## 구현 체크리스트

### 7.1 기능 간 상호작용 검증 (SRS §2.8)

- [x] **파일 감시 + 탭**: switchTab 시 활성 watcher 교체 확인, 비활성 탭 stale 검사 확인 `2026-02-19`
- [x] **PDF 내보내기 + 탭**: "현재 파일" = 활성 탭, "사이드바 전체" = 활성 탭의 트리 `2026-02-19`
- [x] **최근 파일 + 탭**: 트레이 최근 문서 클릭 → 새 창 (탭이 아님) `2026-02-19`
- [x] **사이드바 검색 + 탭**: 검색 결과 클릭 → enableTabs면 새 탭, 아니면 navigateTo `2026-02-19`
- [x] **파일 감시 + PDF 내보내기**: 내보내기 시 파일 변경 → 생성 중인 PDF에 미반영 `2026-02-19`
- [x] **Escape 키 우선순위**: 모달 → 검색 → always-on-top 순서 확인 `2026-02-19`
- [x] **파일 감시 + 사이드바 검색**: 자동 새로고침 시 검색 필터 상태 유지 `2026-02-19`

### 7.2 CLAUDE.md 갱신

**파일**: `CLAUDE.md`

- [x] Settings 테이블에 `autoRefresh`, `enableTabs`, `recentFiles` 추가 `2026-02-19`
- [x] Preload API 목록에 7개 신규 API 추가: `2026-02-19`
  - exportPdf, cancelExport, pdfRenderComplete, onExportProgress
  - readFileForTab, checkFileMtime, openFileDialog
- [x] Keyboard Shortcuts에 `Ctrl+T` (새 탭), `Ctrl+Shift+F` (사이드바 검색) 추가 `2026-02-19`
- [x] Known Limitations 업데이트: `2026-02-19`
  - "File Watching" → 구현 완료 (FR-18-001)
  - "Search" → 사이드바 파일 검색 구현 (FR-18-004)
  - "Export" → PDF 내보내기 구현 (FR-18-003)
- [x] Directory Structure에 신규 파일 4개 추가: `2026-02-19`
  - `src/renderer/image-resolver.js`
  - `src/renderer/sidebar-search.js`
  - `src/renderer/pdf-export-ui.js`
  - `src/renderer/tab-manager.js`
- [x] MCP Tools 테이블 아래에 탭 관련 참고사항 추가 `2026-02-19`

### 7.3 전체 회귀 테스트

- [ ] npm start → 앱 정상 시작
- [ ] MCP 4개 도구 정상 동작 (open/update/close/list)
- [ ] 시스템 트레이 메뉴 전체 항목 동작
- [ ] Settings UI 모든 항목 저장/로드
- [ ] 라이트/다크 테마 전환
- [ ] 키보드 단축키 전체 테스트
- [ ] 4개 로케일 (en, ko, ja, es) 전환 확인
- [ ] 파일 드래그 & 드롭
- [ ] 네비게이션 히스토리 (back/forward)
- [ ] 윈도우 cascading 위치

### 7.4 E2E 테스트 업데이트

- [ ] 기존 `test/doclight.e2e.js` 테스트가 모두 통과하는지 확인
- [ ] 필요 시 Step 18 기능에 대한 E2E 테스트 케이스 추가

## 테스트

### 정상 케이스

```
Given: 모든 7개 기능이 구현된 상태
When: 앱 시작 → 파일 열기 → 탭 생성 → 사이드바 검색 → PDF 내보내기 → 파일 변경 → 최근 파일 클릭
Then: 모든 기능이 충돌 없이 동작
```

### 예외 케이스

```
Given: enableTabs: false, autoRefresh: false
When: 앱 사용
Then: Step 17 이전과 동일한 동작 (하위 호환성)
```

### 경계값 테스트

```
Given: 20개 탭, 사이드바 검색 활성, PDF 모달 열림
When: Escape 키
Then: PDF 모달만 닫힘 (최우선)
```

### 회귀테스트 조건

- [ ] E2E 테스트 전체 통과
- [ ] 메모리 누수 없음 (창 열기/닫기 반복)
- [ ] 앱 종료 시 모든 리소스 정리 (watcher, 포트 파일, 숨겨진 BW)
