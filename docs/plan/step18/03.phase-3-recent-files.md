# Phase 3: 최근 파일 트레이 메뉴

## 목표

시스템 트레이 컨텍스트 메뉴에 "최근 문서" 서브메뉴를 추가하여 최근 열었던 .md 파일에 빠르게 접근할 수 있게 한다 (FR-18-005).

## 선행 조건

- Phase 1 완료 (recentFiles 설정 스키마)
- Phase 2 완료 (파일 감시 안정화)

## 아키텍처 참조

- [00-1.architecture.md](./00-1.architecture.md) §2.3.2 index.js 확장
- SRS §2.5 FR-18-005

## 구현 체크리스트

### 3.1 addRecentFile 함수 (index.js)

**파일**: `src/main/index.js`

- [ ] `addRecentFile(filePath)` 함수 추가:
  - 입력 검증: typeof string, path.isAbsolute, .md/.markdown 확장자
  - 중복 제거 (filter), 맨 앞에 추가 (unshift)
  - 7개 초과 시 slice(0, 7)
  - `store.set('recentFiles', recent)`
  - `updateTrayMenu()` 호출

### 3.2 트레이 메뉴 구조 변경 (index.js)

**파일**: `src/main/index.js` — `updateTrayMenu()` 함수

- [ ] 기존 트레이 메뉴에 "최근 문서" 서브메뉴 추가 (새 뷰어 아래):
  - 각 항목: `파일명 (부모 디렉토리)` 형식
  - 클릭 핸들러: `fs.existsSync(filePath)` 확인 → 존재시 `windowManager.createWindow({ filePath })` → 미존재시 목록에서 제거 + console.log + 트레이 갱신
  - 구분선 + "목록 지우기" 항목
  - 목록 비어있을 때 "(비어 있음)" 비활성 항목
- [ ] i18n 키 사용: `tray.recentDocs`, `tray.clearRecent`, `tray.recentEmpty`

### 3.3 WindowManager에 onRecentFile 콜백 연결

**파일**: `src/main/window-manager.js`

- [ ] `createWindow()`: filePath가 있을 때 `this.onRecentFile?.(filePath)` 호출
- [ ] `navigateTo()`: `this.onRecentFile?.(filePath)` 호출

**파일**: `src/main/index.js`

- [ ] `windowManager.onRecentFile = addRecentFile` 연결
- [ ] `file-dropped` 핸들러에서 `addRecentFile(filePath)` 호출
- [ ] `openFileFromPath()` 에서 `addRecentFile(filePath)` 호출

### 3.4 "목록 지우기" 동작

- [ ] `store.set('recentFiles', [])` 후 `updateTrayMenu()`

## 테스트

### 정상 케이스

```
Given: 최근 파일 목록이 비어 있음
When: test.md 파일을 뷰어에서 열기
Then: 트레이 "최근 문서"에 "test.md (C:\docs)" 표시
```

```
Given: 목록에 [a.md, b.md, c.md]
When: b.md 다시 열기
Then: 목록이 [b.md, a.md, c.md] 순서로 변경
```

### 예외 케이스

```
Given: 최근 파일 클릭, 파일이 삭제됨
When: 트레이에서 "deleted.md" 클릭
Then: 콘솔 로깅, 목록에서 제거, 트레이 갱신
```

```
Given: content-only 모드로 문서 열기
When: MCP open_markdown(content: "# Test")
Then: 최근 파일 목록에 추가되지 않음
```

### 경계값 테스트

```
Given: 7개 파일이 목록에 있음
When: 새 파일 열기
Then: 맨 위 추가, 가장 오래된 항목 제거
```

### 회귀테스트 조건

- [ ] 트레이 메뉴 기존 항목 (새 뷰어, 모든 창 닫기, 설정, 종료) 정상
- [ ] 창 목록 표시 정상
- [ ] 앱 재시작 후 최근 파일 유지
