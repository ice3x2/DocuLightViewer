# Phase 4: ì‚¬ì´ë“œë°” íŒŒì¼ ê²€ìƒ‰

## ëª©í‘œ

ì‚¬ì´ë“œë°” ìƒë‹¨ì— ê²€ìƒ‰ ì…ë ¥ í•„ë“œë¥¼ ì¶”ê°€í•˜ì—¬ íŒŒì¼ íŠ¸ë¦¬ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í•„í„°ë§í•œë‹¤ (FR-18-004). ëŒ€ì†Œë¬¸ì ë¬´ì‹œ ë¶€ë¶„ ì¼ì¹˜ë¡œ íŒŒì¼ëª… ê²€ìƒ‰, ì¼ì¹˜ ë¶€ë¶„ í•˜ì´ë¼ì´íŠ¸.

## ì„ í–‰ ì¡°ê±´

- Phase 1 ì™„ë£Œ (window.DocuLight ë„¤ì„ìŠ¤í˜ì´ìŠ¤, i18n í‚¤)
- Phase 3 ì™„ë£Œ (ì‚¬ì´ë“œë°” ê´€ë ¨ ë³€ê²½ ì•ˆì •í™”)

## ì•„í‚¤í…ì²˜ ì°¸ì¡°

- [00-1.architecture.md](./00-1.architecture.md) Â§2.1 ë Œë”ëŸ¬ ëª¨ë“ˆ ì‹œìŠ¤í…œ
- SRS Â§2.4 FR-18-004, Â§5.4 ì‚¬ì´ë“œë°” ê²€ìƒ‰ ì˜ì—­, Â§5.8.3 ì ‘ê·¼ì„±

## êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 4.1 sidebar-search.js êµ¬í˜„ (ì‹ ê·œ)

**íŒŒì¼**: `src/renderer/sidebar-search.js`

- [ ] IIFE + `window.__docuLightModules` ë“±ë¡
- [ ] `init()` í•¨ìˆ˜:
  - DOM ì°¸ì¡° íšë“: `#btn-sidebar-search`, `#sidebar-search-container`, `.sidebar-search-input`, `.sidebar-search-clear`
  - ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ â†’ ê²€ìƒ‰ ëª¨ë“œ ì§„ì…
  - ê²€ìƒ‰ ì…ë ¥ `input` ì´ë²¤íŠ¸ â†’ `filterSidebarTree(query)` í˜¸ì¶œ
  - X ë²„íŠ¼ í´ë¦­ â†’ ê²€ìƒ‰ ëª¨ë“œ ì¢…ë£Œ
  - Escape í‚¤ â†’ ê²€ìƒ‰ ëª¨ë“œ ì¢…ë£Œ (PDF ëª¨ë‹¬ í™œì„± ì‹œ ì–‘ë³´)

- [ ] `filterSidebarTree(query)` í•¨ìˆ˜:
  - queryê°€ ë¹ˆ ë¬¸ìì—´: ì „ì²´ íŠ¸ë¦¬ í‘œì‹œ (ê²€ìƒ‰ ëª¨ë“œ ìœ ì§€)
  - ì „ì²´ íŠ¸ë¦¬ì—ì„œ íŒŒì¼(ë¹„ë””ë ‰í† ë¦¬) ë…¸ë“œ í”Œë« ìˆ˜ì§‘: `collectAllFiles(tree)`
  - `node.title.toLowerCase().includes(query.toLowerCase())` í•„í„°ë§
  - í•„í„°ë§ ê²°ê³¼ë¥¼ í”Œë« ë¦¬ìŠ¤íŠ¸ë¡œ í‘œì‹œ (ë””ë ‰í† ë¦¬ ê³„ì¸µ ë¬´ì‹œ)
  - íŒŒì¼ëª…ì˜ ì¼ì¹˜ ë¶€ë¶„ì„ `<mark>` íƒœê·¸ë¡œ ê°ì‹¸ê¸°
  - ë¶€ëª¨ ë””ë ‰í† ë¦¬ëª…ì„ `.search-result-dir` ì„œë¸Œí…ìŠ¤íŠ¸ë¡œ í‘œì‹œ
  - ê²°ê³¼ 0ê±´: `viewer.searchNoResults` i18n í‚¤ ë©”ì‹œì§€ í‘œì‹œ

- [ ] `collectAllFiles(tree)` í•¨ìˆ˜:
  - tree.children ì¬ê·€ ìˆœíšŒ
  - íŒŒì¼ ë…¸ë“œ(children ì—†ìŒ ë˜ëŠ” ë¹ˆ ë°°ì—´) ìˆ˜ì§‘
  - `{ title, path, parentDir }` ë°°ì—´ ë°˜í™˜

- [ ] `restoreSidebarTree()` í•¨ìˆ˜:
  - ê²€ìƒ‰ ì…ë ¥ í•„ë“œ ìˆ¨ê¹€
  - `aria-expanded="false"` ê°±ì‹ 
  - ì›ë˜ íŠ¸ë¦¬ DOM ë³µì› (ìºì‹œí•´ë‘” ì›ë³¸ innerHTML)

- [ ] ê²°ê³¼ í´ë¦­ í•¸ë“¤ëŸ¬:
  - `window.DocuLight.fn.navigateToForTab(href)` í˜¸ì¶œ (late binding)
  - ì´ í•¨ìˆ˜ê°€ ì—†ìœ¼ë©´ `window.doclight.navigateTo(href)` í´ë°±

### 4.2 viewer.htmlì— ê²€ìƒ‰ UI ì¶”ê°€

**íŒŒì¼**: `src/renderer/viewer.html`

- [ ] `#sidebar-header` ë‚´ì— ê²€ìƒ‰ í† ê¸€ ë²„íŠ¼ ì¶”ê°€:
  ```html
  <button id="btn-sidebar-search" aria-label="" data-i18n-title="viewer.sidebarSearch"
          aria-expanded="false" aria-controls="sidebar-search-container">ğŸ”</button>
  ```
- [ ] ì‚¬ì´ë“œë°” í—¤ë” ì•„ë˜ì— ê²€ìƒ‰ ì»¨í…Œì´ë„ˆ:
  ```html
  <div id="sidebar-search-container" class="sidebar-search-container hidden">
    <input type="search" class="sidebar-search-input"
           data-i18n-placeholder="viewer.sidebarSearch"
           aria-label="" data-i18n-aria-label="viewer.sidebarSearchAriaLabel"
           autocomplete="off" maxlength="100">
    <button class="sidebar-search-clear" aria-label="Clear search">âœ•</button>
  </div>
  ```

### 4.3 viewer.cssì— ê²€ìƒ‰ ìŠ¤íƒ€ì¼ ì¶”ê°€

**íŒŒì¼**: `src/renderer/viewer.css`

- [ ] `.sidebar-search-container`: ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜, íŒ¨ë”©, ë°°ê²½
- [ ] `.sidebar-search-input`: ë„ˆë¹„ 100%, border, ì…ë ¥ ìŠ¤íƒ€ì¼
- [ ] `.sidebar-search-clear`: ìš°ì¸¡ ì ˆëŒ€ ìœ„ì¹˜, hover íš¨ê³¼
- [ ] `.search-result-item`: í´ë¦­ ê°€ëŠ¥ í•­ëª© ìŠ¤íƒ€ì¼
- [ ] `.search-result-dir`: íšŒìƒ‰ ì‘ì€ ì„œë¸Œí…ìŠ¤íŠ¸
- [ ] `mark` (ê²€ìƒ‰ í•˜ì´ë¼ì´íŠ¸): `background: var(--search-highlight-bg)`
- [ ] `.hidden` í´ë˜ìŠ¤: `display: none`
- [ ] ë‹¤í¬ í…Œë§ˆ ë³€ìˆ˜: `--search-input-bg`, `--search-input-border`, `--search-highlight-bg`

### 4.4 í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (viewer.js)

**íŒŒì¼**: `src/renderer/viewer.js`

- [ ] `Ctrl+Shift+F` / `Cmd+Shift+F` í•¸ë“¤ëŸ¬ ì¶”ê°€:
  - ì‚¬ì´ë“œë°”ê°€ ìˆ¨ê²¨ì ¸ ìˆìœ¼ë©´ ë¨¼ì € í‘œì‹œ
  - `sidebar-search.js`ì˜ ê²€ìƒ‰ ëª¨ë“œ ì§„ì… í•¨ìˆ˜ í˜¸ì¶œ
- [ ] Escape í‚¤ ìš°ì„ ìˆœìœ„ ì²´ì¸ ì—…ë°ì´íŠ¸:
  1. PDF ëª¨ë‹¬ ì—´ë¦¼ â†’ (Phase 5ì—ì„œ êµ¬í˜„)
  2. **ì‚¬ì´ë“œë°” ê²€ìƒ‰ í™œì„± â†’ ê²€ìƒ‰ ëª¨ë“œ ì¢…ë£Œ** (ì´ Phaseì—ì„œ ì¶”ê°€)
  3. always-on-top â†’ í•´ì œ (ê¸°ì¡´)

## í…ŒìŠ¤íŠ¸

### ì •ìƒ ì¼€ì´ìŠ¤

```
Given: ì‚¬ì´ë“œë°”ì— 10ê°œ íŒŒì¼ í‘œì‹œ
When: ê²€ìƒ‰ ì•„ì´ì½˜ í´ë¦­ â†’ "api" ì…ë ¥
Then: "api" í¬í•¨ íŒŒì¼ë§Œ í‘œì‹œ, ì¼ì¹˜ ë¶€ë¶„ <mark> í•˜ì´ë¼ì´íŠ¸
```

```
Given: "API.md"ì™€ "api-guide.md" ì¡´ì¬
When: "api" ê²€ìƒ‰
Then: ë‘ íŒŒì¼ ëª¨ë‘ ê²°ê³¼ì— í‘œì‹œ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
```

### ì˜ˆì™¸ ì¼€ì´ìŠ¤

```
Given: ê²€ìƒ‰ ê²°ê³¼ 0ê±´
When: "zzzzz" ì…ë ¥
Then: "ê²°ê³¼ ì—†ìŒ" ë©”ì‹œì§€ í‘œì‹œ
```

```
Given: ì‚¬ì´ë“œë°”ì— íŒŒì¼ ì—†ìŒ (content-only)
When: í™”ë©´ í™•ì¸
Then: ê²€ìƒ‰ ë²„íŠ¼ ìˆ¨ê¹€ ë˜ëŠ” ë¹„í™œì„±í™”
```

### ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸

```
Given: 100ì ì´ˆê³¼ ê²€ìƒ‰ì–´ ì…ë ¥ ì‹œë„
When: ê¸´ ë¬¸ìì—´ ì…ë ¥
Then: maxlength=100ìœ¼ë¡œ ì˜ë¦¼
```

### íšŒê·€í…ŒìŠ¤íŠ¸ ì¡°ê±´

- [ ] ì‚¬ì´ë“œë°” íŠ¸ë¦¬ ë„¤ë¹„ê²Œì´ì…˜ ì •ìƒ
- [ ] ê²€ìƒ‰ ëª¨ë“œ ì¢…ë£Œ í›„ ì›ë³¸ íŠ¸ë¦¬ ë³µì›
- [ ] Escape í‚¤ ì²´ì¸ (ê²€ìƒ‰ â†’ always-on-top) ì •ìƒ
- [ ] í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ Ctrl+Shift+F ì •ìƒ
