# Phase 6: 도구 설명 개선

## 목표

AI가 상황에 맞는 도구를 선택할 수 있도록 모든 MCP 도구의 설명을 개선합니다.

## 선행 조건

- Phase 1-5 완료

## 아키텍처 참조

- [00-1.architecture.md](./00-1.architecture.md) Section 10

---

## 구현 체크리스트

### 6.1 기존 도구 설명 개선

- [x] list_documents `2026-01-29`
- [x] list_full_tree `2026-01-29`
- [x] read_document `2026-01-29`
- [x] create_document `2026-01-29`
- [x] delete_document `2026-01-29`
- [x] DocuLight_get_config `2026-01-29`
- [x] DocuLight_search `2026-01-29`

### 6.2 새 도구 설명 검토

- [x] DocuLight_smart_search `2026-01-29`
- [x] query_document `2026-01-29`
- [x] summarize_document `2026-01-29`

### 6.3 도구 간 관계 명시

- [x] 각 도구가 언제 사용되어야 하는지 `2026-01-29`
- [x] 대안 도구 제안 `2026-01-29`
- [x] 효율성 힌트 `2026-01-29`

---

## 개선된 도구 설명

### 1. list_documents

**기존:**
```
List all documents in a directory
```

**개선:**
```
List files and folders in a specific directory (non-recursive). Returns names only, not content. Use this when you need to see what's in a single directory. For recursive listing, use list_full_tree instead.
```

### 2. list_full_tree

**기존:**
```
Recursively list all documents and directories starting from a path
```

**개선:**
```
Recursively list all files and directories as a tree structure. Returns paths only, not content. Use maxDepth to limit recursion depth. Warning: Can be large for big document collections. Consider using list_documents for single directory, or DocuLight_search to find specific files.
```

### 3. read_document (중요)

**기존:**
```
Read a markdown document
```

**개선:**
```
Read the COMPLETE content of a markdown document. Returns the full file content which may use many tokens. For better efficiency:
- Use query_document if you need specific information from the document
- Use summarize_document if you need to understand document structure first
- Use DocuLight_smart_search if you're not sure which document contains the information
Only use read_document when you specifically need the entire file content.
```

### 4. create_document

**기존:**
```
Create or update a markdown document
```

**개선:**
```
Create a new markdown document or overwrite an existing one. Requires X-API-Key authentication. The content parameter should be valid markdown. Parent directories are created automatically if they don't exist.
```

### 5. delete_document

**기존:**
```
Delete a document or directory
```

**개선:**
```
Permanently delete a file or directory (including all contents). Requires X-API-Key authentication. This action cannot be undone. For directories, all nested files and folders will be deleted.
```

### 6. DocuLight_get_config

**기존:**
```
Get current runtime configuration with sensitive values masked
```

**개선:**
```
Get current DocLight server configuration. Sensitive values (API keys, etc.) are masked. Use section parameter to get specific config: "ui" for UI settings, "security" for security settings, "ssl" for SSL config, or "all" for everything. Useful for debugging or understanding server setup.
```

### 7. DocuLight_search (개선됨)

**기존:**
```
Search for documents containing specific text
```

**개선:**
```
Search for documents by keyword matching. Searches file names, titles, and content. Use mode parameter to control output detail:
- "titles_only": Minimal output - just file names and titles (fastest, least tokens)
- "snippets": Matched lines with surrounding context (default)
- "full_context": Complete sections containing matches (most detailed)

For semantic/meaning-based search, use DocuLight_smart_search instead. For searching within a known document, use query_document.
```

### 8. DocuLight_smart_search (새 도구)

```
Search documents using semantic search (if embedding configured) or keyword search (fallback). This is the most intelligent search option:
- Automatically uses vector search when available (understands meaning, not just keywords)
- Falls back to keyword search if embedding not configured
- Returns only relevant sections, not full documents
- Use mode="auto" (default) to let the system choose, "semantic" to force vector search, "keyword" for exact text matching

Set maxTokens to control output size. For searching within a specific document, use query_document instead.
```

### 9. query_document (새 도구)

```
Search within a SPECIFIC document and return only sections relevant to your query. Use this when:
- You know which document to look in
- You need specific information, not the whole document
- You want to minimize token usage

Returns sections ranked by relevance within your token budget. For searching across multiple documents, use DocuLight_smart_search instead.
```

### 10. summarize_document (새 도구)

```
Get a structured summary of a document without reading the full content. Returns:
- Table of contents (all headings)
- Key points extracted from each section
- Statistics (word count, section count, code blocks, etc.)

Use this to understand document structure before deciding:
- Whether to read the full document (read_document)
- Which sections to query (query_document)

Much more efficient than reading the entire document.
```

---

## 도구 선택 가이드

AI가 참조할 수 있도록 도구 설명에 다음 가이드를 암시적으로 포함:

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        Tool Selection Guide                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  "문서 목록이 필요해"                                                     │
│  └─► list_documents (단일 디렉토리) or list_full_tree (전체)            │
│                                                                          │
│  "X에 대한 정보를 찾아야 해" (어느 문서인지 모름)                          │
│  └─► DocuLight_smart_search (가장 효율적)                                │
│  └─► DocuLight_search (키워드만 필요할 때)                               │
│                                                                          │
│  "이 문서에서 Y에 대해 알고 싶어" (문서 알고 있음)                         │
│  └─► query_document (특정 정보만)                                        │
│  └─► summarize_document (구조 파악 먼저)                                 │
│  └─► read_document (전체 필요할 때만)                                    │
│                                                                          │
│  "문서 구조를 파악하고 싶어"                                               │
│  └─► summarize_document                                                  │
│                                                                          │
│  "전체 문서 내용이 필요해"                                                 │
│  └─► read_document (마지막 수단)                                         │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 테스트 시나리오

### AI 도구 선택 테스트

다양한 시나리오에서 AI가 적절한 도구를 선택하는지 검증:

**시나리오 1**: "SSL 설정 방법을 알려줘"
- 예상 선택: DocuLight_smart_search 또는 query_document

**시나리오 2**: "setup.md 파일의 설치 단계를 알려줘"
- 예상 선택: query_document (path="setup.md", query="설치")

**시나리오 3**: "이 프로젝트에 어떤 문서들이 있어?"
- 예상 선택: list_documents 또는 list_full_tree

**시나리오 4**: "config.md 파일 전체 내용을 보여줘"
- 예상 선택: read_document

**시나리오 5**: "api-reference.md 문서의 구조를 알려줘"
- 예상 선택: summarize_document

---

## 회귀 테스트 실행 조건

- [x] 모든 Phase 테스트 통과 `2026-01-29` (74/74)
- [x] 기존 MCP 기능 정상 동작 `2026-01-29`
- [x] 도구 설명 업데이트 후 파싱 정상 `2026-01-29`

---

## 구현 순서

1. 기존 도구 설명 업데이트 (mcp.js)
2. 새 도구 설명 최종 검토
3. 통합 테스트
4. AI 도구 선택 테스트 (수동)

---

## mcp.js 수정 예시

```javascript
const TOOLS = [
  {
    name: 'list_documents',
    description: 'List files and folders in a specific directory (non-recursive). Returns names only, not content. Use this when you need to see what\'s in a single directory. For recursive listing, use list_full_tree instead.',
    inputSchema: {
      // ...
    }
  },
  {
    name: 'read_document',
    description: 'Read the COMPLETE content of a markdown document. Returns the full file content which may use many tokens. For better efficiency: Use query_document if you need specific information from the document; Use summarize_document if you need to understand document structure first; Use DocuLight_smart_search if you\'re not sure which document contains the information. Only use read_document when you specifically need the entire file content.',
    inputSchema: {
      // ...
    }
  },
  // ... 나머지 도구들
];
```

---

## 완료 기준

- [x] 모든 도구 설명 업데이트 `2026-01-29`
- [x] 각 도구가 언제 사용되어야 하는지 명확 `2026-01-29`
- [x] 대안 도구 제안 포함 `2026-01-29`
- [x] 효율성 힌트 포함 `2026-01-29`
- [x] AI 도구 선택 테스트 통과 `2026-01-29`

**Phase 6 완료: 2026-01-29** ✅
