# Architecture: DocuLight i18n System

## 1. System Context

DocuLight는 Electron 기반 Markdown 뷰어로, Main Process(Node.js)와 Renderer Process(브라우저)로 나뉜다.
i18n 시스템은 두 프로세스 모두에서 문자열을 제공해야 한다.

```
┌─────────────────────────────────────────────────┐
│                   Main Process                   │
│                                                   │
│  ┌──────────┐   ┌────────────┐   ┌────────────┐ │
│  │ strings.js│──▶│  index.js  │   │file-assoc. │ │
│  │ (loader)  │   │ (tray,IPC) │   │   .js      │ │
│  └─────┬────┘   └────────────┘   └────────────┘ │
│        │                                          │
│        │  IPC: get-strings                        │
│        ▼                                          │
│  ┌──────────┐                                    │
│  │ preload.js│ (contextBridge)                   │
│  └─────┬────┘                                    │
├────────┼────────────────────────────────────────┤
│        ▼         Renderer Process                │
│  ┌──────────┐   ┌────────────┐   ┌────────────┐ │
│  │window.    │──▶│ viewer.js  │   │settings.js │ │
│  │doclight.  │   │ viewer.html│   │settings.html│ │
│  │getStrings │   └────────────┘   └────────────┘ │
│  └──────────┘                                    │
└─────────────────────────────────────────────────┘
```

## 2. Component Design

### 2.1 Locale Files (`src/locales/`)

```
src/locales/
├── ko.json    # 한국어 문자열
└── en.json    # 영어 문자열 (기본)
```

JSON 구조는 dot-notation 키를 flat하게 저장:

```json
{
  "tray.newViewer": "New Viewer",
  "tray.closeAll": "Close All Windows",
  "tray.settings": "Settings",
  "tray.quit": "Quit DocuLight",
  "settings.title": "DocuLight Settings",
  ...
}
```

### 2.2 Strings Module (`src/main/strings.js`)

- 앱 시작 시 `app.getLocale()`로 시스템 언어 감지
- locale 파일 로드 (ko.json 또는 en.json)
- 매칭 안 되면 en.json 폴백
- `t(key)` 함수로 문자열 반환
- `t(key, { var })` 형태로 변수 치환 지원

```js
// 사용 예시
const { t } = require('./strings');
t('tray.newViewer')           // → "새 뷰어" (한국어 시스템)
t('error.maxWindows', { max: 20 }) // → "최대 창 수(20)에 도달했습니다"
```

### 2.3 Renderer 전달 방식

Main → Renderer로 문자열 전달은 **IPC handle** 사용:

1. `ipcMain.handle('get-strings')` → 전체 locale 객체 반환
2. `preload.js`에 `window.doclight.getStrings()` 추가
3. Renderer에서 DOMContentLoaded 시 문자열 로드
4. HTML 요소에 `data-i18n="key"` 속성으로 자동 치환

### 2.4 MCP 문자열 처리

MCP 도구 설명 및 응답은 **영어 고정** — API 소비자(Claude Desktop 등)가 영어를 기대하므로 i18n 대상에서 제외.
단, 두 MCP 서버(stdio/HTTP)의 중복 문자열은 공유 상수로 추출.

## 3. Data Flow

```
App Start
  │
  ▼
app.getLocale() → "ko" / "en" / "ja" / ...
  │
  ▼
Match to supported locale? ──No──▶ fallback to "en"
  │ Yes
  ▼
Load src/locales/{locale}.json
  │
  ▼
Export t(key, vars?) function
  │
  ├──▶ Main Process: direct require('./strings')
  │
  └──▶ Renderer Process: IPC handle('get-strings') → preload bridge
         │
         ▼
       DOMContentLoaded → data-i18n 속성 치환 + JS 문자열 교체
```

## 4. Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| 리소스 형식 | JSON | 프로젝트가 이미 JSON 기반 설정 사용, 추가 파서 불필요 |
| 키 네이밍 | flat dot-notation | 중첩 객체보다 조회 성능 좋고, 검색 편리 |
| 변수 치환 | `{varName}` 문법 | 외부 라이브러리 없이 간단 구현 가능 |
| Renderer 전달 | IPC handle | 기존 패턴과 일관성, contextIsolation 호환 |
| MCP 문자열 | i18n 제외 | API 계약이므로 언어 고정 |
| 콘솔 로그 | i18n 제외 | 개발자 전용, 영어 유지 |
