# Phase 3: Renderer Process 문자열 교체

## 목표

Renderer Process(viewer, settings)의 사용자 노출 문자열을 i18n 시스템으로 교체한다.

## 선행 조건

- Phase 1 완료 (strings.js, locale 파일, IPC bridge)
- Phase 2 완료 (Main Process 교체 — 동일 패턴 검증 완료)

## 아키텍처 참조

Renderer에서는 두 가지 방식으로 문자열을 적용:

1. **HTML 정적 문자열**: `data-i18n` 속성 → DOMContentLoaded에서 자동 치환
2. **JS 동적 문자열**: `t(key, vars?)` 헬퍼 함수

### Renderer i18n 헬퍼 (공통 패턴)

각 renderer JS 파일 상단에 추가:

```js
let _strings = {};

function t(key, vars) {
  let str = _strings[key];
  if (str === undefined) return key;
  if (vars) {
    for (const [k, v] of Object.entries(vars)) {
      str = str.replace(new RegExp(`\\{${k}\\}`, 'g'), String(v));
    }
  }
  return str;
}

async function initI18n() {
  try {
    const { strings } = await window.doclight.getStrings();
    _strings = strings;
  } catch {
    _strings = {};
  }
  // data-i18n 속성 자동 치환
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    const translated = t(key);
    if (translated !== key) {
      el.textContent = translated;
    }
  });
  // data-i18n-title (tooltip) 치환
  document.querySelectorAll('[data-i18n-title]').forEach(el => {
    const key = el.getAttribute('data-i18n-title');
    const translated = t(key);
    if (translated !== key) {
      el.setAttribute('title', translated);
    }
  });
  // data-i18n-placeholder 치환
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.getAttribute('data-i18n-placeholder');
    const translated = t(key);
    if (translated !== key) {
      el.setAttribute('placeholder', translated);
    }
  });
}
```

## 구현 체크리스트

### 3.1 `src/renderer/settings.html` — 정적 문자열

HTML 요소에 `data-i18n` 또는 `data-i18n-title` 속성 추가:

| 현재 텍스트 | i18n 키 | HTML 변경 |
|-------------|---------|----------|
| `설정` (h1) | `settings.heading` | `<h1 data-i18n="settings.heading">Settings</h1>` |
| `테마` | `settings.theme` | `<label data-i18n="settings.theme">Theme</label>` |
| `글꼴 크기 (px)` | `settings.fontSize` | `data-i18n="settings.fontSize"` |
| `글꼴 패밀리` | `settings.fontFamily` | `data-i18n="settings.fontFamily"` |
| `코드 테마` | `settings.codeTheme` | `data-i18n="settings.codeTheme"` |
| `MCP 서버 포트` | `settings.mcpPort` | `data-i18n="settings.mcpPort"` |
| `변경 시 앱 재시작 필요` | `settings.mcpPortHint` | `data-i18n="settings.mcpPortHint"` |
| `기본 창 크기` | `settings.defaultWindowSize` | `data-i18n="settings.defaultWindowSize"` |
| `Auto (마지막 크기 기억)` | `settings.windowSizeAuto` | `data-i18n="settings.windowSizeAuto"` |
| `파일 연결` | `settings.fileAssociation` | `data-i18n="settings.fileAssociation"` |
| `.md 파일의 기본 앱으로 등록` | `settings.fileAssocCheckbox` | `data-i18n="settings.fileAssocCheckbox"` |
| `시스템 기본 앱 설정 열기` | `settings.openDefaultApps` | `data-i18n="settings.openDefaultApps"` |
| `기본값으로 초기화` | `settings.resetButton` | `data-i18n="settings.resetButton"` |
| `저장` | `settings.saveButton` | `data-i18n="settings.saveButton"` |
| `설정이 저장되었습니다` | `settings.savedMessage` | `data-i18n="settings.savedMessage"` |

**HTML 기본 텍스트는 영어로** — i18n 로드 전 잠깐 보이더라도 영어가 표시됨.

`<title>` 태그는 JS에서 치환: `document.title = t('settings.pageTitle');`

### 3.2 `src/renderer/settings.js` — 동적 문자열

| 현재 문자열 | i18n 키 | vars |
|-------------|---------|------|
| `'모든 설정을 기본값으로 초기화하시겠습니까?'` | `settings.resetConfirm` | |
| `'빌드된 앱에서만 사용 가능합니다'` | `settings.unsupported` | |
| `'등록 후 시스템 설정에서 기본 앱을 선택해야 합니다'` | `settings.hintMac` | |
| `'등록 후 "연결 프로그램"에서 DocuLight를 선택할 수 있습니다'` | `settings.hintWindows` | |
| `'XDG MIME 기반으로 등록됩니다'` | `settings.hintLinux` | |
| `'상태를 확인할 수 없습니다'` | `settings.cannotCheckStatus` | |
| `'처리 중...'` | `settings.processing` | |
| `` `오류: ${err.message}` `` | `settings.errorPrefix` | `{ message }` |

### 3.3 `src/renderer/viewer.html` — 정적 문자열

| 현재 텍스트 | i18n 키 | 속성 |
|-------------|---------|------|
| `Navigation` (사이드바 헤더) | `viewer.navigation` | `data-i18n` |
| `목차` (TOC 헤더) | `viewer.tocHeader` | `data-i18n` |
| `파일 목록 (Ctrl+B)` (버튼 title) | `viewer.sidebarToggle` | `data-i18n-title` |
| `목차` (버튼 title) | `viewer.tocToggle` | `data-i18n-title` |
| `항상 위에 표시` (버튼 title) | `viewer.pinToggle` | `data-i18n-title` |

`<title>DocuLight</title>`은 브랜드명이므로 유지.

### 3.4 `src/renderer/viewer.js` — 동적 문자열

| 현재 문자열 | i18n 키 | vars |
|-------------|---------|------|
| `` `Mermaid 렌더링 오류: ${err.message}` `` | `viewer.mermaidError` | `{ message }` |
| `` `이 문서는 매우 큽니다...` `` | `viewer.largeDocWarning` | `{ sizeMB }` |
| `'Markdown 파일을 여기에 드래그하세요'` | `viewer.dropHint` | |
| `'.md 파일만 지원됩니다'` | `viewer.dropFileType` | |
| `'Untitled'` | `viewer.untitled` | |

### 3.5 DOMContentLoaded 통합

각 renderer의 `DOMContentLoaded` 핸들러에서 `initI18n()` 호출:

**settings.js**:
```js
document.addEventListener('DOMContentLoaded', async () => {
  await initI18n();
  loadSettings();
  initFileAssociation();
});
```

**viewer.js**:
```js
// window-ready 이벤트 전에 i18n 초기화
// 또는 기존 초기화 로직에 통합
await initI18n();
```

## 테스트 시나리오

### 정상 케이스

**TC-3.1**: 한국어 설정 UI
- Given: locale = ko
- When: 설정 창 열기
- Then: 모든 라벨, 버튼, 힌트가 한국어로 표시

**TC-3.2**: 영어 뷰어 UI
- Given: locale = en
- When: 뷰어 창에서 빈 상태(드롭존) 표시
- Then: "Drag a Markdown file here", "Only .md files are supported"

### 예외 케이스

**TC-3.3**: i18n 로드 실패
- Given: `getStrings()` IPC 에러
- When: settings.html 로드
- Then: 영어 기본 텍스트 표시 (HTML에 하드코딩된 영어 폴백)

**TC-3.4**: 대용량 문서 경고 (한국어)
- Given: locale = ko, 5MB markdown 파일
- When: 파일 열기
- Then: "이 문서는 매우 큽니다 (5MB). 렌더링에 시간이 걸릴 수 있습니다."

### 경계값

**TC-3.5**: data-i18n 속성 누락 키
- Given: HTML에 `data-i18n="nonexistent.key"` 속성
- When: initI18n() 실행
- Then: 원래 텍스트 유지 (키가 없으면 변경하지 않음)

## Phase 완료 기준

- [ ] settings.html 15개 정적 문자열에 data-i18n 적용
- [ ] settings.js 8개 동적 문자열 t() 호출로 교체
- [ ] viewer.html 5개 정적 문자열에 data-i18n / data-i18n-title 적용
- [ ] viewer.js 5개 동적 문자열 t() 호출로 교체
- [ ] DOMContentLoaded에서 initI18n() 호출
- [ ] 한국어/영어 모두 올바르게 표시
- [ ] i18n 로드 실패 시 영어 폴백 동작
