# Phase 2: Main Process 문자열 교체

## 목표

Main Process의 사용자 노출 하드코딩 문자열을 `t()` 호출로 교체한다.

## 선행 조건

- Phase 1 완료 (strings.js 모듈, locale 파일, IPC bridge)

## 아키텍처 참조

- `t(key, vars?)` — `src/main/strings.js`에서 import
- `file-association.js`는 직접 `require('./strings')`

## 구현 체크리스트

### 2.1 `src/main/index.js` — 트레이 메뉴

| 현재 문자열 | i18n 키 | 비고 |
|-------------|---------|------|
| `'외 ${n}개...'` | `tray.overflow` | vars: `{ count }` |
| `'새 뷰어'` | `tray.newViewer` | |
| `'모든 창 닫기'` | `tray.closeAll` | |
| `'설정'` | `tray.settings` | |
| `'DocuLight 종료'` | `tray.quit` | |
| `` `Window ${info.windowId}` `` | `tray.windowFallback` | vars: `{ windowId }` |
| `'DocuLight 설정'` (설정 창 title) | `settings.pageTitle` | |

**변경 예시**:
```js
// Before
menuItems.push({ label: '새 뷰어', click: ... });

// After
menuItems.push({ label: t('tray.newViewer'), click: ... });
```

### 2.2 `src/main/index.js` — IPC 에러/파일 연결

| 현재 문자열 | i18n 키 |
|-------------|---------|
| `'빌드된 앱에서만 사용 가능합니다'` | `fileAssoc.unsupported` |

### 2.3 `src/main/window-manager.js` — 에러 메시지

`window-manager.js`에도 `const { t } = require('./strings');` 추가.

| 현재 문자열 | i18n 키 | vars |
|-------------|---------|------|
| `'Either content or filePath must be provided'` | `error.contentRequired` | |
| `'Only .md files are supported: ${filePath}'` | `error.mdOnly` | `{ filePath }` |
| `'Maximum number of windows (${MAX_WINDOWS}) reached'` | `error.maxWindows` | `{ max }` |
| `'Window not found: ${windowId}'` | `error.windowNotFound` | `{ windowId }` |
| `'Either content or filePath must be provided for update'` | `error.contentRequiredUpdate` | |

**주의**: 이 에러 메시지는 MCP 응답에도 전파된다. MCP 소비자는 에러 메시지를 파싱하지 않으므로 locale 변경 무방.

### 2.4 `src/main/file-association.js` — 결과 메시지

`file-association.js`에 `const { t } = require('./strings');` 추가.

| 현재 문자열 | i18n 키 | vars |
|-------------|---------|------|
| `'파일 연결이 등록되었습니다'` (Win) | `fileAssoc.registered` | |
| `'파일 연결이 해제되었습니다'` (Win) | `fileAssoc.unregistered` | |
| `'빌드된 앱에서만 사용 가능합니다'` (Mac ×2) | `fileAssoc.unsupported` | |
| `'Applications 폴더로 이동 후 등록해주세요'` | `fileAssoc.moveToApps` | |
| `'lsregister를 찾을 수 없습니다'` | `fileAssoc.noLsregister` | |
| `'등록 완료. 시스템 설정에서 기본 앱을 선택해주세요.'` | `fileAssoc.macSuccess` | |
| `'파일 연결이 해제되었습니다'` (Mac) | `fileAssoc.macUnregistered` | |
| `'파일 연결이 등록되었습니다'` (Linux) | `fileAssoc.linuxRegistered` | |
| `'파일 연결이 해제되었습니다'` (Linux) | `fileAssoc.linuxUnregistered` | |
| `'지원하지 않는 플랫폼: ${platform}'` (×2) | `fileAssoc.unsupportedPlatform` | `{ platform }` |

## 테스트 시나리오

### 정상 케이스

**TC-2.1**: 한국어 트레이 메뉴
- Given: locale = ko
- When: 트레이 아이콘 우클릭
- Then: 메뉴 항목이 한국어로 표시 ("새 뷰어", "모든 창 닫기" 등)

**TC-2.2**: 영어 트레이 메뉴
- Given: locale = en
- When: 트레이 아이콘 우클릭
- Then: 메뉴 항목이 영어로 표시 ("New Viewer", "Close All Windows" 등)

### 예외 케이스

**TC-2.3**: 최대 창 초과 에러
- Given: 20개 창이 열려 있음
- When: 새 창 열기 시도
- Then: 에러 메시지가 현재 locale로 표시

**TC-2.4**: 파일 연결 등록 (비빌드 모드)
- Given: 개발 모드 실행
- When: 파일 연결 등록 시도
- Then: "빌드된 앱에서만 사용 가능합니다" (ko) / "Only available in built app" (en)

### 경계값

**TC-2.5**: 트레이 overflow 메시지
- Given: MAX_TRAY_ITEMS = 10, 열린 창 = 15
- When: 트레이 메뉴 표시
- Then: "외 5개..." (ko) / "5 more..." (en)

## Phase 완료 기준

- [ ] `index.js` 트레이 메뉴 7개 문자열 교체
- [ ] `window-manager.js` 에러 메시지 5개 교체
- [ ] `file-association.js` 결과 메시지 12개 교체
- [ ] 한국어/영어 환경에서 트레이 메뉴 올바르게 표시
- [ ] 에러 발생 시 locale에 맞는 메시지 출력
