# DocuLight 개발 계획

## 📋 프로젝트 현황

### 완료된 작업 (Phase 0: Boilerplate)

#### ✅ 프로젝트 구조
- [x] 디렉터리 구조 생성 (src, public, docs, logs)
- [x] package.json 및 의존성 설정
- [x] .gitignore 설정
- [x] 설정 파일 템플릿 (config.example.json5)

#### ✅ 백엔드 코어
- [x] Express 애플리케이션 설정 (src/app.js)
- [x] 설정 로더 (utils/config-loader.js)
- [x] 로깅 시스템 (utils/logger.js)
- [x] 경로 검증 (utils/path-validator.js)
- [x] 락 매니저 (utils/lock-manager.js)

#### ✅ 미들웨어
- [x] 인증 미들웨어 (middleware/auth.js)
- [x] 에러 핸들러 (middleware/error-handler.js)
- [x] 요청 로거 (middleware/request-logger.js)

#### ✅ API 컨트롤러 (기본 구현)
- [x] 트리 컨트롤러 (controllers/tree-controller.js)
- [x] Raw 파일 컨트롤러 (controllers/raw-controller.js)
- [x] 업로드 컨트롤러 (controllers/upload-controller.js)
- [x] 삭제 컨트롤러 (controllers/delete-controller.js)
- [x] 다운로드 컨트롤러 (controllers/download-controller.js)

#### ✅ 라우팅
- [x] API 라우터 (routes/api.js)

#### ✅ 프론트엔드
- [x] EJS 템플릿 (views/index.ejs)
- [x] CSS 스타일링 (public/css/style.css)
- [x] 클라이언트 JavaScript (public/js/app.js)
- [x] IndexedDB 통합
- [x] Marked.js 통합
- [x] Mermaid.js 통합
- [x] DOMPurify 통합

#### ✅ 문서
- [x] README.md
- [x] SRS (docs/srs.md)
- [x] SDS (docs/sds.md)

---

## 🧪 테스트 지침 (Test-Driven Development)

### 필수 규칙

**각 기능 구현 후 즉시 테스트 실행**
- 모든 Phase의 각 단계 완료 시 관련 테스트 수행
- 테스트 통과 확인 후 다음 단계 진행
- 실패 시 즉시 수정 및 재테스트

### 테스트 레벨

#### 1. 개발 중 테스트 (Development Testing)
- **수동 테스트**: 브라우저 개발자 도구 활용
- **API 테스트**: curl 또는 Postman 사용
- **로그 확인**: Winston 로그 파일 검토

#### 2. 기능 테스트 (Feature Testing)
- **단위 기능**: 각 기능이 의도대로 동작하는지 확인
- **에러 케이스**: 예외 상황 처리 검증
- **성능**: 응답 시간 측정

#### 3. 통합 테스트 (Integration Testing)
- **워크플로우**: 전체 사용자 시나리오 테스트
- **API 연동**: 프론트엔드-백엔드 통신 검증
- **데이터 흐름**: 전체 데이터 흐름 확인

### 테스트 체크리스트

각 기능 완료 시 다음 항목 확인:

- [ ] 기능이 예상대로 동작하는가?
- [ ] 에러가 적절히 처리되는가?
- [ ] 로그가 올바르게 기록되는가?
- [ ] 보안 검증이 작동하는가?
- [ ] 성능 목표를 충족하는가?
- [ ] UI/UX가 직관적인가?

### 테스트 실행 방법

#### Phase 1 기능 테스트
```bash
# 1. 서버 시작
npm run dev

# 2. 브라우저에서 테스트
# http://localhost:3000

# 3. API 테스트 (예시)
curl -X GET http://localhost:3000/api/tree
curl -H "X-API-Key: your-key" -F "file=@test.md" http://localhost:3000/api/upload

# 4. 로그 확인
tail -f logs/DocuLight-*.log
```

#### Phase 2 자동화 테스트
```bash
# 단위 테스트
npm test

# 커버리지 확인
npm run test:coverage

# 통합 테스트
npm run test:integration

# E2E 테스트
npm run test:e2e
```

### 테스트 실패 시 프로세스

1. **에러 로그 확인**: 로그 파일 및 콘솔 출력 검토
2. **원인 분석**: 디버거 또는 console.log 활용
3. **수정**: 코드 수정 및 재테스트
4. **검증**: 수정 사항이 다른 기능에 영향 없는지 확인
5. **문서화**: plan.md에 발견된 이슈 및 해결 방법 기록

---

## 🎯 Phase 1: 핵심 기능 완성 및 테스트 (우선순위: P0)

### 1.1 ZIP 파일 처리 구현 ✅ **완료**

**구현 내용**:
- [x] ZIP 파일 압축 해제 기능
- [x] 상대 경로 기준 파일 추출
- [x] 경로 안전성 검증 (../ 차단)
- [x] 압축 해제 중 에러 처리
- [x] 진행 상황 로깅

**구현 파일**:
- `src/controllers/upload-controller.js`: extractZipFile 함수 추가
- `package.json`: adm-zip 의존성 추가

**테스트**: TEST.md의 Phase 1.1 섹션 참조

---

### 1.2 디렉터리 트리 확장/축소 기능 ✅ **완료**

**구현 내용**:
- [x] 디렉터리 확장/축소 UI 로직
- [x] 하위 디렉터리 동적 로딩
- [x] IndexedDB 상태 저장/복원
- [x] 확장 상태 아이콘 표시 (▶/▼)
- [x] 부드러운 애니메이션

**구현 파일**:
- `public/js/app.js`: buildTree, toggleDirectory 함수 구현
- `public/css/style.css`: 트리 스타일 및 애니메이션 추가

**테스트**: TEST.md의 Phase 1.2 섹션 참조

---

### 1.3 에러 처리 강화 ✅ **완료**

**구현 내용**:
- [x] 클라이언트 에러 UI 개선
- [x] 네트워크 오류 재시도 로직 (최대 3회)
- [x] 타임아웃 처리 (10초)
- [x] 사용자 친화적 에러 메시지
- [x] 에러 상태 복구 메커니즘

**구현 파일**:
- `public/js/app.js`: ErrorHandler 유틸리티, fetchWithRetry 함수 추가
- `public/css/style.css`: 에러 메시지 및 로딩 스타일 추가

**테스트**: TEST.md의 Phase 1.3 섹션 참조

**참고**: 파일 업로드/다운로드/삭제는 외부 API로만 처리 (UI 불필요)

---

## 📝 Phase 1 완료 요약

**완료일**: 2025-10-23
**소요 시간**: 14시간

모든 Phase 1 기능이 구현 완료되었습니다. 상세 내용은 `PHASE1_COMPLETE.md` 참조.

**다음 단계**: TEST.md 가이드에 따라 수동 테스트 수행 후 Phase 2 또는 Phase 4 진행

---

## 🧪 Phase 2: 테스트 및 품질 보증 (우선순위: P1)

### 2.1 단위 테스트 작성

**구현 내용**:
- [ ] 테스트 프레임워크 설정 (Jest/Mocha)
- [ ] 유틸리티 함수 테스트
  - config-loader.js
  - path-validator.js
  - lock-manager.js
- [ ] 미들웨어 테스트
  - auth.js
  - error-handler.js
- [ ] 컨트롤러 테스트
  - 각 API 엔드포인트

**예상 시간**: 16시간

**목표 커버리지**: 80% 이상

---

### 2.2 통합 테스트

**구현 내용**:
- [ ] API 엔드포인트 통합 테스트
- [ ] 파일 업로드/다운로드 워크플로우
- [ ] 에러 시나리오 테스트
- [ ] 동시성 테스트
- [ ] 성능 테스트

**도구**: Supertest, Jest

**예상 시간**: 12시간

---

### 2.3 E2E 테스트

**구현 내용**:
- [ ] Playwright/Puppeteer 설정
- [ ] 사용자 워크플로우 테스트
  - 파일 탐색
  - 문서 열람
  - 파일 업로드/다운로드/삭제
- [ ] 브라우저 호환성 테스트
- [ ] 모바일 반응형 테스트

**예상 시간**: 16시간

---

### 2.4 보안 테스트

**구현 내용**:
- [ ] 경로 탐색 공격 테스트
- [ ] XSS 공격 테스트
- [ ] API 키 인증 우회 시도
- [ ] SQL Injection (해당 없음, 파일 기반)
- [ ] CSRF 방지 (필요시)
- [ ] 파일 업로드 악용 방지

**예상 시간**: 8시간

---

## 🚀 Phase 3: 사용자 경험 개선 (우선순위: P2)

### 3.1 검색 기능

**구현 내용**:
- [ ] 파일명 검색
- [ ] 전문 검색 (Markdown 내용)
- [ ] 검색 결과 하이라이팅
- [ ] 검색 히스토리

**예상 시간**: 12시간

---

### 3.2 북마크 기능

**구현 내용**:
- [ ] 즐겨찾기 파일 저장
- [ ] 북마크 UI (별표 아이콘)
- [ ] IndexedDB에 북마크 저장
- [ ] 북마크 목록 보기

**예상 시간**: 6시간

---

### 3.3 Markdown 에디터

**구현 내용**:
- [ ] 인라인 편집 기능
- [ ] 실시간 미리보기
- [ ] 자동 저장
- [ ] 버전 히스토리 (옵션)

**예상 시간**: 20시간

---

### 3.4 테마 지원

**구현 내용**:
- [ ] 다크 모드
- [ ] 테마 전환 버튼
- [ ] 테마 설정 IndexedDB 저장
- [ ] 커스텀 색상 테마

**예상 시간**: 8시간

---

### 3.5 반응형 디자인 강화

**구현 내용**:
- [ ] 모바일 레이아웃 최적화
- [ ] 터치 제스처 지원
- [ ] 사이드바 토글 기능
- [ ] 태블릿 레이아웃

**예상 시간**: 10시간

---

## 📦 Phase 4: 배포 준비 (우선순위: P1)

### 4.1 프로덕션 최적화

**구현 내용**:
- [ ] 정적 파일 최적화 (minify, compress)
- [ ] 이미지 최적화
- [ ] 캐싱 전략 구현
- [ ] CDN 설정 (옵션)
- [ ] Gzip/Brotli 압축

**예상 시간**: 8시간

---

### 4.2 Docker 컨테이너화

**구현 내용**:
- [ ] Dockerfile 작성
- [ ] docker-compose.yml 작성
- [ ] 볼륨 마운트 설정
- [ ] 헬스체크 설정
- [ ] 멀티 스테이지 빌드

**예상 시간**: 6시간

---

### 4.3 CI/CD 파이프라인

**구현 내용**:
- [ ] GitHub Actions 워크플로우
- [ ] 자동 테스트 실행
- [ ] 자동 배포 스크립트
- [ ] 버전 태깅
- [ ] 릴리스 노트 자동 생성

**예상 시간**: 8시간

---

### 4.4 모니터링 및 알림

**구현 내용**:
- [ ] 헬스체크 엔드포인트 강화
- [ ] 메트릭 수집 (Prometheus/Grafana)
- [ ] 에러 알림 (Slack/Email)
- [ ] 로그 집계 (ELK Stack)

**예상 시간**: 12시간

---

### 4.5 문서화

**구현 내용**:
- [ ] API 문서 (Swagger/OpenAPI)
- [ ] 사용자 가이드
- [ ] 관리자 가이드
- [ ] 트러블슈팅 가이드
- [ ] FAQ

**예상 시간**: 10시간

---

## 🔮 Phase 5: 향후 개선 사항 (우선순위: P3)

### 5.1 다중 루트 지원

**구현 내용**:
- [ ] 설정에 docsRoots 배열 지원
- [ ] 루트 선택 UI
- [ ] 루트별 권한 관리

**예상 시간**: 16시간

---

### 5.2 사용자 인증 및 권한

**구현 내용**:
- [ ] JWT 기반 인증
- [ ] 사용자 등록/로그인
- [ ] 역할 기반 접근 제어 (RBAC)
- [ ] 파일별 권한 설정

**예상 시간**: 24시간

---

### 5.3 버전 관리

**구현 내용**:
- [ ] 파일 버전 히스토리
- [ ] 버전 간 비교 (diff)
- [ ] 이전 버전 복원
- [ ] Git 통합

**예상 시간**: 20시간

---

### 5.4 협업 기능

**구림 내용**:
- [ ] 실시간 공동 편집 (WebSocket)
- [ ] 댓글 시스템
- [ ] 변경 알림
- [ ] 활동 로그

**예상 시간**: 32시간

---

### 5.5 플러그인 시스템

**구현 내용**:
- [ ] 플러그인 아키텍처 설계
- [ ] 플러그인 API
- [ ] 플러그인 마켓플레이스
- [ ] 샘플 플러그인

**예상 시간**: 40시간

---

## 📊 개발 일정 (추정)

### Sprint 1 (Week 1-2): Phase 1 완성
- ZIP 처리 (4h) ✅
- 트리 확장/축소 (6h)
- 에러 처리 강화 (4h)

**총 예상 시간**: 14시간 (1주)

**참고**: 파일 업로드/다운로드/삭제는 외부 API로만 처리하므로 UI 구현 불필요

---

### Sprint 2 (Week 3-4): Phase 2 테스트
- 단위 테스트 (16h)
- 통합 테스트 (12h)
- E2E 테스트 (16h)
- 보안 테스트 (8h)

**총 예상 시간**: 52시간 (2주)

---

### Sprint 3 (Week 5-6): Phase 4 배포 준비
- 프로덕션 최적화 (8h)
- Docker 컨테이너화 (6h)
- CI/CD 파이프라인 (8h)
- 모니터링 및 알림 (12h)
- 문서화 (10h)

**총 예상 시간**: 44시간 (2주)

---

### Sprint 4+ (Week 7+): Phase 3 UX 개선 (선택적)
- 검색 기능 (12h)
- 북마크 기능 (6h)
- Markdown 에디터 (20h)
- 테마 지원 (8h)
- 반응형 디자인 강화 (10h)

**총 예상 시간**: 56시간 (2주)

---

## 🎯 핵심 마일스톤

### M1: MVP 릴리스 (Week 1)
- ✅ 기본 파일 탐색 및 Markdown 렌더링
- ✅ ZIP 파일 처리 (API)
- ⏳ 트리 확장/축소
- ⏳ 에러 처리 강화
- **참고**: 파일 관리는 외부 API 사용

### M2: 베타 릴리스 (Week 4)
- ✅ 전체 테스트 완료
- ✅ 보안 검증 완료
- ✅ 문서화 완료

### M3: 프로덕션 릴리스 (Week 6)
- ✅ Docker 이미지 제공
- ✅ CI/CD 파이프라인 가동
- ✅ 모니터링 시스템 구축

### M4: v1.0 릴리스 (Week 8+)
- ✅ 사용자 피드백 반영
- ✅ 성능 최적화
- ✅ 추가 기능 구현

---

## 🔧 기술 부채 관리

### 현재 알려진 기술 부채
1. ~~**ZIP 압축 해제 미구현**~~: ✅ 완료
2. **디렉터리 트리 동적 로딩 미구현**: 전체 트리를 한 번에 로드
3. **에러 UI 개선 필요**: 기본적인 에러 표시만 제공
4. **테스트 부재**: 단위/통합/E2E 테스트 없음
5. **성능 최적화 미실시**: 대용량 파일/디렉터리 처리 최적화 필요

### 해결 우선순위
1. **P0**: 테스트 작성, 트리 확장/축소
2. **P1**: 에러 UI 개선, 성능 최적화
3. **P2**: 동적 트리 로딩

---

## 📝 메모 및 결정 사항

### 아키텍처 결정
- **프론트엔드**: Vanilla JS (프레임워크 없음) - 경량성 유지
- **인증**: 단일 API 키 → 향후 JWT로 마이그레이션 고려
- **데이터베이스**: 파일 시스템 기반 (DB 없음)
- **상태 관리**: 브라우저 IndexedDB

### 성능 목표
- **초기 로딩**: < 2초
- **파일 열람**: < 1초
- **트리 확장**: < 500ms
- **파일 업로드**: 10MB 기준 < 5초

### 보안 목표
- **경로 탐색 방지**: 100% 차단
- **XSS 방지**: DOMPurify 사용
- **API 인증**: 모든 쓰기 작업 보호

---

## 🚧 현재 차단 요소

### 차단 없음
모든 기능이 독립적으로 개발 가능한 상태입니다.

---

## 📞 다음 액션

### 즉시 시작 가능한 작업
1. ~~**ZIP 압축 해제 구현**~~ ✅ 완료 (Phase 1.1)
2. **디렉터리 트리 확장/축소** (Phase 1.2) ⏳ 다음 작업
3. **에러 처리 강화** (Phase 1.3)

### 검토 필요한 사항
1. 테스트 프레임워크 선택 (Jest vs Mocha)
2. E2E 테스트 도구 선택 (Playwright vs Puppeteer)
3. 배포 환경 결정 (Docker, PM2, etc.)

---

**작성일**: 2025-10-23
**버전**: 1.0
**다음 업데이트**: Sprint 1 완료 시
