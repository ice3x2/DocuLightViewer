# Phase 3: CLAUDE.md 업데이트

## 목적

프로젝트 CLAUDE.md에 frontmatter 메타데이터 파라미터를 문서화하고, Claude Code(AI 어시스턴트)가 `open_markdown` 호출 시 메타데이터를 적극적으로 채우도록 유도하는 규칙을 추가한다.

---

## 수정 대상 파일

### 1. `CLAUDE.md` (프로젝트 루트)

---

#### 1-1. MCP Tools 테이블 업데이트

**변경 위치**: `## MCP Tools` 섹션의 테이블 (현재 구조)

현재 `open_markdown` 행:
```
| `open_markdown` | `content` OR `filePath`, `title`, `size` (s/m/l/f), `foreground`, `alwaysOnTop`, `windowName`, `severity` (info/success/warning/error), `tags` (string[]), `flash`, `progress` (-1~1.0), `autoCloseSeconds` (1~3600) | Open or upsert named viewer window |
```

변경:
```
| `open_markdown` | `content` OR `filePath`, `title`, `size` (s/m/l/f), `foreground`, `alwaysOnTop`, `windowName`, `severity` (info/success/warning/error), `tags` (string[]), `flash`, `progress` (-1~1.0), `autoCloseSeconds` (1~3600), `project` (string), `docName` (string), `description` (string, **recommended**) | Open or upsert named viewer window |
```

현재 `update_markdown` 행:
```
| `update_markdown` | `windowId`, `content` OR `filePath`, `title`, `appendMode`, `separator`, `severity`, `tags`, `flash`, `progress`, `autoCloseSeconds` | Update existing window content and/or metadata |
```

변경:
```
| `update_markdown` | `windowId`, `content` OR `filePath`, `title`, `appendMode`, `separator`, `severity`, `tags`, `flash`, `progress`, `autoCloseSeconds`, `project`, `docName`, `description` | Update existing window content and/or metadata |
```

---

#### 1-2. Frontmatter Metadata 섹션 신규 추가

**삽입 위치**: `### MCP Client Configuration (Claude Desktop)` 섹션 바로 위에 새 섹션 추가

```markdown
### Frontmatter Metadata Parameters (Step 20)

`open_markdown` and `update_markdown` accept optional metadata parameters that are auto-composed into YAML frontmatter at the top of the content:

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `project` | `string` | optional | Project name (e.g., "DocuLight", "MyApp") |
| `docName` | `string` | optional | Document name/identifier (e.g., "API Reference") |
| `description` | `string` | **recommended** | Document summary. Always provide a brief description of the content. |

**Auto-composed fields:**
- `date`: Automatically added as ISO 8601 timestamp

**Rules:**
- If any of `project`, `docName`, `description` is provided, a YAML frontmatter block is prepended to the content
- If the content already has a frontmatter block (`---`...`---`), new fields are merged (new values take priority)
- The Viewer parses frontmatter and displays it as a collapsible metabox above the content
- Frontmatter is NOT passed to the markdown renderer — it only appears in the metabox UI
- In `appendMode`, frontmatter is NOT injected

**Example call:**
```json
{
  "name": "open_markdown",
  "arguments": {
    "content": "# API Reference\n\n## Endpoints\n...",
    "title": "API Docs",
    "project": "DocuLight",
    "docName": "API Reference",
    "description": "DocuLight MCP 서버의 REST API 엔드포인트 문서",
    "windowName": "api-docs",
    "severity": "info"
  }
}
```
```

---

#### 1-3. open_markdown 호출 규칙 섹션 추가

**삽입 위치**: 위 Frontmatter Metadata 섹션 바로 아래

```markdown
### open_markdown Best Practices for AI Assistants

When calling `open_markdown`, follow these guidelines:

1. **Always provide `description`**: Include a 1-2 sentence summary of the document content. This helps users quickly understand what the document is about.

2. **Set `project` when context is clear**: If working within a specific project, include the project name for organization.

3. **Use `docName` for identification**: Provide a human-readable document name that distinguishes this document from others.

4. **Combine with `windowName` for upsert**: Use `windowName` together with metadata for consistent document updates.

5. **Use `severity` to indicate document type**:
   - `info`: General documentation, references
   - `success`: Completed results, success reports
   - `warning`: Warnings, things to review
   - `error`: Error reports, critical issues

**Recommended pattern:**
```json
{
  "content": "...",
  "windowName": "unique-doc-name",
  "project": "ProjectName",
  "docName": "Document Title",
  "description": "Brief summary of the document content",
  "severity": "info"
}
```
```

---

#### 1-4. WindowEntry.meta 테이블 업데이트 (있는 경우)

**변경 위치**: `### WindowEntry.meta New Fields (Step 19)` 섹션

이 섹션의 제목을 변경하고 Step 20 필드를 추가하거나, 별도 Step 20 섹션을 추가:

```markdown
### WindowEntry.meta — Frontmatter Fields (Step 20)

Frontmatter metadata is injected into `content` at the MCP layer level. No new `WindowEntry.meta` fields are needed — the metadata lives within the content string itself and is parsed by the renderer.
```

---

## 구체적 변경 내용 요약

| 위치 | 변경 유형 | 내용 |
|------|-----------|------|
| MCP Tools 테이블 | 수정 | `open_markdown`, `update_markdown` 행에 `project`, `docName`, `description` 파라미터 추가 |
| Frontmatter Metadata Parameters | **신규 섹션** | 파라미터 설명, 규칙, 예시 |
| open_markdown Best Practices | **신규 섹션** | AI 어시스턴트 호출 가이드라인 |
| WindowEntry.meta | 추가 | Frontmatter는 meta 필드가 아닌 content 내 데이터임을 명시 |

---

## 테스트 시나리오

### T1: CLAUDE.md 문서 정확성 검증
- CLAUDE.md를 읽고 MCP Tools 테이블에 새 파라미터가 정확히 기재되어 있는지 확인
- 파라미터 타입, 필수 여부, 설명이 실제 구현과 일치하는지 확인

### T2: AI 어시스턴트 유도 효과 검증
- Claude Desktop에서 open_markdown 호출 시 description을 포함하는 경향이 있는지 확인
- description 설명의 "STRONGLY RECOMMENDED" / "recommended" 표기가 AI 동작에 영향을 주는지 관찰

### T3: 기존 문서 무결성
- CLAUDE.md의 기존 섹션(Architecture, Development Commands 등)이 손상되지 않았는지 확인
- 마크다운 렌더링이 정상인지 확인

---

## 완료 기준

1. [x] MCP Tools 테이블에 `project`, `docName`, `description` 파라미터 추가
2. [x] Frontmatter Metadata Parameters 섹션 작성 (파라미터 설명, 규칙, 예시)
3. [x] open_markdown Best Practices 섹션 작성 (AI 호출 가이드라인)
4. [x] 기존 CLAUDE.md 내용 무결성 유지
5. [x] 실제 구현과 문서 내용 일치
