# Phase 6: 통합 및 마무리

## 목표

- Phase 1~5 전체 기능 통합 검증
- 기능 간 상호작용 테스트
- CLAUDE.md 업데이트 (MCP Tools 표, WindowEntry.meta 필드)
- E2E 시나리오 검증

## 선행 조건

- Phase 1~5 모두 완료
- 모든 Phase 검증 문서 A+ 달성

## 구현 체크리스트

### 1. 기능 간 상호작용 검증

- [x] Named Window + Severity + Tags 조합:
  - `open_markdown { windowName: "alarm", severity: "error", tags: ["critical"] }` 정상 동작
  - `list_viewers { tag: "critical" }` → 창 1개 반환, severity와 tags 모두 표시
- [x] Named Window + Auto-close 조합:
  - `open_markdown { windowName: "temp-alarm", autoCloseSeconds: 10 }` 으로 열기
  - 10초 후 창 닫힘, `nameToId`에서 매핑 제거 확인
  - 이후 같은 windowName으로 재열기 → 새 창 생성 확인
- [x] Named Window + Append 조합:
  - `open_markdown { windowName: "log", content: "시작" }` 으로 열기
  - `open_markdown { windowName: "log", content: "항목 1\n", appendMode: ... }` — upsert는 append 불가
  - `update_markdown { windowId: X, content: "항목 1", appendMode: true }` 로 append
- [x] Flash + Progress 조합:
  - `open_markdown { flash: true, progress: 0.3, content: "..." }` 정상 동작
  - `update_markdown { windowId: X, progress: 0.6, flash: true }` 정상 동작
- [x] Tags + close_viewer 일괄 닫기 + autoCloseTimer 정리:
  - tags: ["temp"] 인 창 3개 (각각 다른 autoCloseSeconds 설정)
  - `close_viewer { tag: "temp" }` 호출
  - 3개 창 모두 닫힘, 각 창의 autoCloseTimer clearTimeout 확인 (누수 없음)

### 2. list_viewers 전체 포맷 검증

- [x] 모든 신규 필드가 포함된 응답 예시:
  ```
  Open viewer windows (2):
    1. [win-42] "오류 보고서" (named: alarm) (severity: error) [tags: alarm, critical] (progress: 75%)
    2. [win-43] "진행 상황" (severity: info) [tags: progress]
  ```
- [x] 필드가 없는 경우 깔끔하게 생략 (undefined 출력 없음)

### 3. CLAUDE.md 업데이트

- [x] **MCP Tools 표** — `open_markdown` 파라미터 업데이트:
  - `windowName`, `severity`, `autoCloseSeconds`, `tags`, `flash`, `progress` 추가
- [x] **MCP Tools 표** — `update_markdown` 파라미터 업데이트:
  - `appendMode`, `separator`, `severity`, `tags`, `flash`, `progress`, `autoCloseSeconds` 추가
- [x] **MCP Tools 표** — `close_viewer` 파라미터 업데이트: `tag` 추가
- [x] **MCP Tools 표** — `list_viewers` 파라미터 업데이트: `tag` 추가
- [x] **WindowEntry.meta** 신규 필드 설명 추가 (있다면)

### 4. 병렬 알람·보고 환경 E2E 시나리오

```
# AI 에이전트 병렬 작업 보고 시나리오
1. open_markdown { windowName: "status-1", severity: "info", tags: ["status"], progress: 0.0, content: "# 작업 A 시작" }
2. open_markdown { windowName: "status-2", severity: "info", tags: ["status"], progress: 0.0, content: "# 작업 B 시작" }
3. update_markdown { windowId: X1, progress: 0.5, content: "# 작업 A: 50%" }
4. update_markdown { windowId: X2, progress: 0.3, content: "# 작업 B: 30%" }
5. update_markdown { windowId: X1, progress: 1.0, severity: "success", content: "# 작업 A 완료", flash: true }
6. open_markdown { windowName: "error-1", severity: "error", tags: ["alarm"], flash: true, autoCloseSeconds: 30, content: "# 오류 발생!" }
7. list_viewers { tag: "status" } → 2개 창
8. close_viewer { tag: "status" } → 2개 창 닫힘
```

- [x] 시나리오 전체 수동 테스트 통과

## 테스트 시나리오

### 전체 통합 케이스: 병렬 알람 환경 시뮬레이션
- **Given**: 빈 상태
- **When**: 위 E2E 시나리오 1~8단계 순차 실행
- **Then**: 각 단계 예상 결과 일치, 오류 없음

### 회귀: 기존 기능 비파괴 검증
- **Given**: Step 18 기능(파일 감시, PDF 내보내기, 탭 등)이 구현된 상태
- **When**: Step 19 기능 활성화 후 Step 18 기능 재테스트
- **Then**: 기존 기능 정상 동작

## 회귀테스트 실행 조건

- [x] `open_markdown` (windowName 없음, 기존 방식) 정상 동작
- [x] `update_markdown` (appendMode: false, 기존 방식) 정상 동작
- [x] `close_viewer` (windowId 지정, 기존 방식) 정상 동작
- [x] `list_viewers` (tag 없음, 기존 방식) 정상 동작
- [x] 탭 기능 (FR-18-006) 정상 동작
- [x] PDF 내보내기 (FR-18-003) 정상 동작
- [x] 파일 감시 (FR-18-001) 정상 동작
- [x] severity 없는 창에서 severity-bar 미표시
- [x] autoCloseSeconds 없는 창에서 auto-close-bar 미표시
- [x] CLAUDE.md 문서 업데이트 완료
