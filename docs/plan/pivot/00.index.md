# 00. 구현 계획 목차 — DocLight Electron + MCP Pivot

## 메타데이터

| 항목 | 내용 |
|------|------|
| **프로젝트** | DocLight — Electron Markdown Viewer + MCP Server |
| **입력 문서** | [srs.pivot.md](../srs.pivot.md) (pivot-v1.0, 만장일치 A+ 달성) |
| **성격** | 완전 피봇: Express 웹 서버 → Electron 데스크톱 앱 |
| **언어/프레임워크** | Node.js 20+, Electron 33+, @modelcontextprotocol/sdk |
| **프로젝트 규모** | MEDIUM (6개 기능 요구사항, 62개 테스트 항목) |
| **Phase 수** | 6개 |
| **생성일** | 2026-02-13 |

## 비즈니스 목표

| ID | 목표 | 우선순위 |
|----|------|----------|
| BG-001 | AI 에이전트가 MCP를 통해 Markdown 뷰어를 제어하는 네이티브 데스크톱 앱 제공 | P0 |
| BG-002 | 기존 Express 웹 서버 코드 완전 제거 (클린 피봇) | P0 |
| BG-003 | 다중 뷰어 창 관리 및 링크 기반 사이드바 네비게이션 | P0 |
| BG-004 | 시스템 트레이 상주 앱 + electron-builder 패키징 | P1 |

## Phase 요약

| Phase | 제목 | 파일 | 주요 산출물 | 의존성 |
|-------|------|------|-------------|--------|
| **0** | 아키텍처 설계 | [00-1.architecture.md](00-1.architecture.md) | 시스템 구조, 컴포넌트, 시퀀스 | - |
| **0** | 기술 결정 | [00-2.tech-decisions.md](00-2.tech-decisions.md) | ADR 8개, 라이브러리 목록 | - |
| **1** | 기존 코드 정리 | [01.phase-1-cleanup.md](01.phase-1-cleanup.md) | 클린 프로젝트 상태, 새 디렉토리 구조 | - |
| **2** | Electron Main Process | [02.phase-2-electron-main.md](02.phase-2-electron-main.md) | index.js, preload.js, window-manager.js | Phase 1 |
| **3** | MCP Bridge Process | [03.phase-3-mcp-bridge.md](03.phase-3-mcp-bridge.md) | mcp-server.js (4개 도구) | Phase 2 |
| **4** | 마크다운 뷰어 창 | [04.phase-4-viewer.md](04.phase-4-viewer.md) | viewer.html, viewer.js, viewer.css | Phase 2, 3 |
| **5** | 사이드바 네비게이션 | [05.phase-5-sidebar.md](05.phase-5-sidebar.md) | link-parser.js, 사이드바 UI | Phase 4 |
| **6** | 설정 및 패키징 | [06.phase-6-settings-polish.md](06.phase-6-settings-polish.md) | settings UI, electron-builder, 문서 | Phase 5 |

## Phase 의존성 그래프

```
Phase 1 (Cleanup)
    │
    ▼
Phase 2 (Electron Main) ────────┐
    │                            │
    ▼                            ▼
Phase 3 (MCP Bridge)       Phase 4 (Viewer)  ← 병렬 가능
    │                            │
    └────────────┬───────────────┘
                 ▼
           Phase 5 (Sidebar)
                 │
                 ▼
           Phase 6 (Settings/Polish)
```

**병렬 실행 가능**: Phase 3과 Phase 4는 Phase 2 완료 후 동시 진행 가능 (파일 충돌 없음)

## 요구사항 추적 매트릭스

| 요구사항 ID | 설명 | Phase | 구현 파일 |
|-------------|------|-------|-----------|
| FR-P-001 | Electron 앱 기본 구조 | 2 | index.js |
| FR-P-002 | MCP 서버 (4개 도구) | 3 | mcp-server.js |
| FR-P-003 | 마크다운 뷰어 창 | 4 | viewer.html/js/css |
| FR-P-004 | 링크 기반 사이드바 | 5 | link-parser.js, viewer.js |
| FR-P-005 | 기존 기능 제거 | 1 | (삭제 작업) |
| FR-P-006 | 설정 및 구성 | 6 | settings UI, electron-store |
| NFR-P-001 | 성능 | 6 | 전체 검증 |
| NFR-P-002 | 보안 | 4, 6 | CSP, DOMPurify, preload |
| NFR-P-003 | 호환성 | 6 | electron-builder |
| NFR-P-004 | 리소스 사용 | 6 | 전체 검증 |

## 검증 문서

| 문서 | 경로 | 생성 시점 |
|------|------|-----------|
| Phase 1 검증 | [verification/phase-1-verification.md](verification/phase-1-verification.md) | Phase 1 완료 후 |
| Phase 2 검증 | [verification/phase-2-verification.md](verification/phase-2-verification.md) | Phase 2 완료 후 |
| Phase 3 검증 | [verification/phase-3-verification.md](verification/phase-3-verification.md) | Phase 3 완료 후 |
| Phase 4 검증 | [verification/phase-4-verification.md](verification/phase-4-verification.md) | Phase 4 완료 후 |
| Phase 5 검증 | [verification/phase-5-verification.md](verification/phase-5-verification.md) | Phase 5 완료 후 |
| Phase 6 검증 | [verification/phase-6-verification.md](verification/phase-6-verification.md) | Phase 6 완료 후 |
| 통합 테스트 가이드 | [integration-test-guide.md](integration-test-guide.md) | 전체 Phase 완료 후 |
| 최종 검증 보고서 | [final-validation.md](final-validation.md) | 통합 테스트 완료 후 |

## 산출물 파일 목록 (신규 생성)

| 파일 | 위치 | 설명 |
|------|------|------|
| `index.js` | `src/main/` | Electron 앱 진입점 (트레이, IPC 소켓, 생명주기) |
| `mcp-server.js` | `src/main/` | MCP Bridge (stdio, 4개 도구) — 별도 프로세스 |
| `window-manager.js` | `src/main/` | 뷰어 창 CRUD + 네비게이션 히스토리 |
| `link-parser.js` | `src/main/` | Markdown 링크 파싱 + 재귀 트리 빌드 |
| `preload.js` | `src/main/` | contextBridge API 노출 |
| `viewer.html` | `src/renderer/` | 뷰어 페이지 레이아웃 |
| `viewer.js` | `src/renderer/` | 렌더링 파이프라인 + 사이드바 UI |
| `viewer.css` | `src/renderer/` | GitHub-flavored MD 스타일 + 테마 |
| `electron-builder.yml` | 루트 | 빌드/패키징 설정 |
| `package.json` | 루트 | 의존성 전면 변경 |

## 중복 코드 방지 체크리스트

- [ ] 모든 렌더링 로직은 `viewer.js` 단일 파일에만 존재
- [ ] IPC 소켓 프레이밍(ndjson)은 `index.js`와 `mcp-server.js`에서 각각 구현 (프로세스 분리로 공유 불가, 중복이 아닌 필수 분리)
- [ ] 라이브러리(marked, purify 등)는 `src/renderer/lib/`에만 존재, npm 중복 설치 없음 (단, marked는 link-parser용으로 npm에도 필요)
- [ ] 유틸리티 함수 추출 금지: 한 번만 사용되는 로직은 인라인
- [ ] 기존 Express 코드 잔재 0개 (Phase 1에서 완전 제거)

## 죽은 코드 제거 대상 (Phase 1)

Phase 1에서 제거할 파일/디렉토리 전체 목록은 [01.phase-1-cleanup.md](01.phase-1-cleanup.md)에 상세 기술.

**요약**: 기존 177개 소스 파일 중 약 170개 제거, 7개 유지 (lib/*.min.js 4개, icon.png 1개, docs/ 전체, package.json)
