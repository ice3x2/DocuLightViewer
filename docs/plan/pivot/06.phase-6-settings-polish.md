# Phase 6: 설정 관리, 키보드 단축키, 패키징

## 목표

설정 UI(BrowserWindow 기반 폼), 키보드 단축키 완성, electron-builder 패키징, 문서 재작성, 성능 검증, 보안 검증을 수행하여 프로젝트를 배포 가능한 상태로 마무리한다.

## 선행 조건

- Phase 5 완료 (전체 기능 동작 — 뷰어 렌더링 + 사이드바 네비게이션 + 링크 파싱)
- Phase 1~5의 모든 기능이 통합 테스트를 통과한 상태

## 아키텍처 참조

- [00-1.architecture.md](./00-1.architecture.md) Section 2.1 (Main Process — System Tray), Section 5.2 (영구 데이터 — electron-store), Section 6 (패키지 구조)
- [00-2.tech-decisions.md](./00-2.tech-decisions.md) ADR-006 (설정 관리 — electron-store)

## SRS 참조

- **FR-P-006**: 설정 및 구성 — 설정 스키마, 유효 범위, 설정 접근 UI
- **NFR-P-001**: 성능 — 창 열기 < 500ms, 렌더링 < 200ms, 트리 빌드 < 500ms
- **NFR-P-002**: 보안 — DOMPurify, CSP, shell.openExternal 화이트리스트, IPC 소켓 퍼미션
- **NFR-P-003**: 호환성 — Windows 10+, macOS 12+, Linux (Ubuntu 20.04+)
- **NFR-P-004**: 리소스 사용 — 백그라운드 < 50MB, 창 1개 < 100MB 추가
- **AC-P-007**: 설정 관리 인수 조건
- **AC-P-008**: 외부 링크 및 보안 인수 조건
- **AC-P-009**: 창 제목 및 content+filePath 동시 제공 인수 조건
- **AC-P-010**: 키보드 단축키 인수 조건

---

## 구현 체크리스트

### 6.1 설정 UI

- [ ] **설정 창 (BrowserWindow) 생성** (window-manager.js 또는 별도 settings-window.js):
  - 트레이 컨텍스트 메뉴 "설정" 클릭 시 열림
  - BrowserWindow 옵션:
    ```javascript
    {
      width: 500,
      height: 600,
      resizable: false,
      minimizable: false,
      maximizable: false,
      title: 'DocLight 설정',
      webPreferences: {
        preload: path.join(__dirname, 'preload.js'),
        contextIsolation: true,
        nodeIntegration: false,
        sandbox: true
      }
    }
    ```
  - 싱글턴: 이미 열려 있으면 기존 창 포커스, 새 창 생성하지 않음

- [ ] **설정 페이지 생성** (`src/renderer/settings.html` + `src/renderer/settings.js` + `src/renderer/settings.css`):
  - **settings.html**: 폼 레이아웃, CSP 메타 태그 (viewer.html과 동일)
  - **settings.js**: 설정 로드/저장 IPC 핸들러
  - **settings.css**: 설정 폼 스타일

- [ ] **설정 폼 UI 항목**:

  | 항목 | 입력 타입 | 기본값 | 유효 범위 |
  |------|----------|--------|----------|
  | 테마 (theme) | `<select>`: light / dark | light | `"light"`, `"dark"` |
  | 글꼴 크기 (fontSize) | `<input type="number">` | 16 | 8 ~ 32 |
  | 글꼴 패밀리 (fontFamily) | `<input type="text">` | system-ui, -apple-system, sans-serif | 비어있지 않은 문자열 |
  | 코드 테마 (codeTheme) | `<select>`: github, monokai, dracula, ... | github | highlight.js 유효 테마 |
  | 창 너비 (defaultWindowWidth) | `<input type="number">` | 1000 | 400 ~ 3840 |
  | 창 높이 (defaultWindowHeight) | `<input type="number">` | 750 | 300 ~ 2160 |
  | 사이드바 너비 (sidebarWidth) | `<input type="number">` | 260 | 150 ~ 800 |
  | 최대 재귀 깊이 (maxRecursionDepth) | `<input type="number">` | 10 | 1 ~ 20 |

- [ ] **저장 버튼** ("저장"):
  - 폼 값 수집 → 유효성 검증 (범위 외 값 → 해당 필드 기본값으로 대체)
  - IPC `save-settings` 전송 → Main Process에서 electron-store에 저장
  - 테마 변경 시: 모든 열린 뷰어 창에 `theme-changed` IPC 브로드캐스트
  - 폰트/코드테마 변경 시: 모든 열린 뷰어 창에 `settings-changed` IPC 브로드캐스트
  - 창 크기 변경: 새로 열리는 창에만 적용 (기존 창 유지)
  - 저장 완료 알림: 폼 하단에 "설정이 저장되었습니다" 메시지 2초간 표시

- [ ] **초기화 버튼** ("기본값으로 초기화"):
  - 확인 다이얼로그 표시
  - 모든 설정을 기본값으로 리셋
  - electron-store 업데이트 + 열린 뷰어 창에 브로드캐스트
  - 폼 UI도 기본값으로 갱신

- [ ] **설정 로드** (설정 창 열림 시):
  - IPC `get-settings` 요청 → Main에서 electron-store 읽기 → 응답
  - 폼 필드에 현재 값 세팅

- [ ] **preload.js 확장** — 설정 관련 IPC 추가:
  ```javascript
  // 기존 doclight 네임스페이스에 추가
  getSettings: () => ipcRenderer.invoke('get-settings'),
  saveSettings: (settings) => ipcRenderer.invoke('save-settings', settings),
  onThemeChanged: (callback) => { /* 기존 */ },
  onSettingsChanged: (callback) => { ... }
  ```

- [ ] **electron-store 스키마 정의** (index.js 또는 별도 파일):
  ```javascript
  const store = new Store({
    schema: {
      theme: { type: 'string', enum: ['light', 'dark'], default: 'light' },
      fontSize: { type: 'number', minimum: 8, maximum: 32, default: 16 },
      fontFamily: { type: 'string', minLength: 1, default: 'system-ui, -apple-system, sans-serif' },
      codeTheme: { type: 'string', default: 'github' },
      defaultWindowWidth: { type: 'number', minimum: 400, maximum: 3840, default: 1000 },
      defaultWindowHeight: { type: 'number', minimum: 300, maximum: 2160, default: 750 },
      sidebarWidth: { type: 'number', minimum: 150, maximum: 800, default: 260 },
      maxRecursionDepth: { type: 'number', minimum: 1, maximum: 20, default: 10 }
    }
  });
  ```

### 6.2 키보드 단축키 완성

- [ ] **뷰어 창 단축키** (viewer.js의 keydown 핸들러 완성):

  | 단축키 | 동작 | 구현 방식 |
  |--------|------|----------|
  | `Ctrl+F` / `Cmd+F` | 문서 내 텍스트 검색 | Electron 내장 findInPage (기본 동작 허용) |
  | `Ctrl+W` / `Cmd+W` | 현재 뷰어 창 닫기 | `window.close()` |
  | `Ctrl+=` / `Cmd+=` | 확대 | `doclight.zoomIn()` (preload → webFrame) |
  | `Ctrl+-` / `Cmd+-` | 축소 | `doclight.zoomOut()` |
  | `Ctrl+0` / `Cmd+0` | 확대/축소 초기화 | `doclight.zoomReset()` |
  | `Ctrl+B` / `Cmd+B` | 사이드바 토글 | Phase 5에서 구현된 토글 함수 호출 |
  | `Ctrl+ArrowLeft` / `Alt+ArrowLeft` | 뒤로가기 | `doclight.navigateBack()` |
  | `Ctrl+ArrowRight` / `Alt+ArrowRight` | 앞으로가기 | `doclight.navigateForward()` |
  | `Escape` | always-on-top 해제 | `doclight.releaseAlwaysOnTop()` |

- [ ] **preload.js에 줌/always-on-top API 추가**:
  ```javascript
  zoomIn: () => ipcRenderer.send('zoom-in'),
  zoomOut: () => ipcRenderer.send('zoom-out'),
  zoomReset: () => ipcRenderer.send('zoom-reset'),
  releaseAlwaysOnTop: () => ipcRenderer.send('release-always-on-top')
  ```

- [ ] **Main Process 줌 IPC 핸들러** (index.js 또는 window-manager.js):
  - `zoom-in`: `win.webContents.setZoomLevel(current + 0.5)` (최대 5.0)
  - `zoom-out`: `win.webContents.setZoomLevel(current - 0.5)` (최소 -3.0)
  - `zoom-reset`: `win.webContents.setZoomLevel(0)`
  - `release-always-on-top`: `win.setAlwaysOnTop(false)` + meta 업데이트

- [ ] **macOS 플랫폼 감지**: `process.platform === 'darwin'`에서 Cmd 키 사용, 그 외 Ctrl 키
  - viewer.js에서 `e.metaKey` (macOS) 또는 `e.ctrlKey` (Windows/Linux) 분기

### 6.3 electron-builder 패키징 설정

- [ ] **`electron-builder.yml` 생성** (프로젝트 루트):
  ```yaml
  appId: com.doclight.app
  productName: DocLight
  copyright: Copyright (c) 2026

  directories:
    buildResources: assets
    output: dist

  files:
    - src/**/*
    - assets/**/*
    - package.json

  win:
    target:
      - target: nsis
        arch:
          - x64
    icon: assets/icon.ico
    artifactName: DocLight-Setup-${version}.exe

  nsis:
    oneClick: false
    allowToChangeInstallationDirectory: true
    createDesktopShortcut: true
    createStartMenuShortcut: true

  mac:
    target:
      - target: dmg
        arch:
          - x64
          - arm64
    icon: assets/icon.icns
    category: public.app-category.developer-tools
    artifactName: DocLight-${version}-${arch}.dmg

  linux:
    target:
      - target: AppImage
        arch:
          - x64
    icon: assets/icon.png
    category: Development
    artifactName: DocLight-${version}.AppImage
  ```

- [ ] **package.json 수정**:
  - `"main": "src/main/index.js"` (Electron 진입점)
  - `"bin"` 필드 추가 (MCP Bridge CLI):
    ```json
    "bin": {
      "doclight-mcp": "src/main/mcp-server.js"
    }
    ```
  - 빌드 스크립트:
    ```json
    "scripts": {
      "start": "electron .",
      "dev": "electron . --dev",
      "build": "electron-builder",
      "build:win": "electron-builder --win",
      "build:mac": "electron-builder --mac",
      "build:linux": "electron-builder --linux"
    }
    ```
  - 프로덕션 의존성 정리: `@modelcontextprotocol/sdk`, `electron-store`, `uuid`, `marked`만 유지
  - 개발 의존성: `electron`, `electron-builder`만 유지

- [ ] **assets/ 디렉토리 확인**:
  - `assets/icon.png` (256x256, 앱/트레이 아이콘)
  - `assets/icon.ico` (Windows, 멀티 해상도)
  - `assets/icon.icns` (macOS)
  - 아이콘 파일이 없으면 임시 아이콘 생성 (최소 256x256 PNG)

### 6.4 CLAUDE.md 재작성

- [ ] 기존 CLAUDE.md 백업 (`CLAUDE.md.bak`)
- [ ] Electron 아키텍처 기반으로 전면 재작성:
  - 프로젝트 개요: Electron + MCP 기반 Markdown 뷰어
  - 디렉토리 구조: `src/main/`, `src/renderer/`, `assets/`
  - 개발 명령어: `npm start`, `npm run dev`, `npm run build`
  - 아키텍처 설명: Main/Renderer/MCP Bridge 프로세스 구조
  - MCP 도구 목록: open_markdown, update_markdown, close_viewer, list_viewers
  - 설정 관리: electron-store 스키마
  - 키보드 단축키 표
  - 코딩 컨벤션 및 보안 주의사항
  - 기존 Express 관련 내용 전부 제거

### 6.5 README.md 재작성

- [ ] 사용자 대상 문서로 전면 재작성:
  - 설치 방법 (릴리즈 다운로드 또는 npm install)
  - MCP 클라이언트 설정 방법 (Claude Desktop, Claude Code):
    ```json
    {
      "mcpServers": {
        "doclight": {
          "command": "doclight-mcp",
          "args": []
        }
      }
    }
    ```
  - 사용법: MCP 도구 호출 예시
  - 설정 변경: 트레이 → 설정
  - 키보드 단축키 표
  - 개발 가이드 (빌드 방법)

### 6.6 성능 검증

- [ ] **창 열기 시간 측정** (< 500ms 목표):
  - MCP open_markdown 호출 → window-ready IPC 수신까지 시간 측정
  - `console.time()` / `console.timeEnd()` 또는 `performance.now()` 사용
  - 빈 문서: < 300ms
  - 일반 문서 (10KB): < 500ms

- [ ] **렌더링 시간 측정** (< 200ms 목표):
  - render-markdown IPC 수신 → hljs.highlightAll() 완료까지
  - 100KB 문서 기준

- [ ] **트리 빌드 시간 측정** (< 500ms 목표):
  - buildLinkTree() 호출 → 반환까지
  - 10개 파일 기준: < 500ms
  - 50개 파일 기준: < 2,000ms (로딩 인디케이터 표시 확인)

- [ ] **메모리 사용량 측정**:
  - 백그라운드 상주 (창 없음): < 50MB (작업 관리자 확인)
  - 뷰어 창 1개 (일반): < 100MB 추가

### 6.7 보안 검증

- [ ] **DOMPurify 새니타이징 테스트**:
  - `<script>alert(1)</script>` → 제거됨
  - `<img onerror="alert(1)" src="x">` → onerror 제거됨
  - `<iframe src="evil.com">` → 제거됨

- [ ] **CSP 강제 테스트**:
  - 인라인 스크립트 실행 차단 확인 (DevTools 콘솔에서 CSP 위반 에러 확인)
  - 외부 스크립트 로딩 차단 확인

- [ ] **shell.openExternal URL 화이트리스트 테스트**:
  - `https://google.com` → 시스템 브라우저에서 열림
  - `http://example.com` → 시스템 브라우저에서 열림
  - `javascript:alert(1)` → 차단됨 (openExternal 호출 안 됨)
  - `file:///etc/passwd` → 차단됨
  - `data:text/html,...` → 차단됨

- [ ] **IPC 소켓 퍼미션 테스트**:
  - macOS/Linux: `/tmp/doclight-ipc.sock` 파일 퍼미션이 `0o600`인지 확인
  - Windows: Named Pipe는 현재 사용자 세션만 접근 가능 (기본 ACL)

---

## 제거 대상 코드 (Dead/Unnecessary Code)

이 Phase에서 전체 피봇이 완료되므로, 남아있는 **모든 Express 기반 코드를 일괄 정리**한다:

| 파일/디렉토리 경로 | 제거 사유 |
|-------------------|----------|
| `src/app.js` | Express 앱 진입점. `src/main/index.js`로 완전 대체 |
| `src/routes/` (전체) | Express 라우트. Electron IPC로 대체 |
| `src/controllers/` (전체) | Express 컨트롤러. Electron window-manager + IPC로 대체 |
| `src/middleware/` (전체) | Express 미들웨어 (auth, error-handler, request-logger, ip-whitelist, admin-auth). Electron에서 불필요 |
| `src/services/` (전체) | Express 서비스 (chatbot, mcp, cache, config, context, search 등). 완전 재설계 |
| `src/utils/` (전체, config-loader 포함) | Express 유틸리티. electron-store + 단순화된 유틸로 대체 |
| `src/views/` (전체) | EJS 템플릿. Electron renderer HTML로 대체 |
| `public/` (전체) | Express 정적 파일. `src/renderer/`로 대체 |
| `config.json5` / `config.example.json5` | JSON5 설정. electron-store로 대체 |
| `start.bat` / `stop.bat` | Express 서버 관리 스크립트. Electron 트레이 앱으로 대체 |
| `nodemon.json` | nodemon 설정. Electron 개발에서 불필요 |
| `test/` (기존 테스트 전체) | Express 기반 테스트. 새 아키텍처에 맞는 테스트로 교체 필요 |

**제거하면 안 되는 파일:**

| 파일/디렉토리 | 유지 사유 |
|--------------|----------|
| `docs/` | 프로젝트 문서 (plan 포함). 피봇 이력 보존 |
| `assets/` | 아이콘 파일. Electron 빌드에 사용 |
| `package.json` | 수정 후 유지 (의존성 전면 교체) |
| `package-lock.json` | `npm install` 후 재생성 |
| `.gitignore` | 수정 후 유지 (node_modules, dist, logs 등) |
| `LICENSE` | 라이센스 유지 |

> **실행 순서**: 코드 제거는 Phase 6의 **마지막 단계**에서 수행한다. 모든 새 코드가 동작 확인된 후에 기존 코드를 삭제한다. `git`으로 삭제 전 커밋을 만들어 롤백 가능하게 한다.

---

## 테스트 시나리오

### 정상 케이스

**TC-6-01: 설정 변경 시 테마 즉시 반영**

```
Given: 설정 창이 열려 있고 뷰어 창이 2개 열린 상태이며 현재 테마가 light인 상태
When: 설정 창에서 테마를 dark로 변경하고 "저장" 버튼을 클릭한다
Then: 두 뷰어 창 모두 즉시 dark 테마로 전환된다
  And: 배경색이 #0d1117, 텍스트색이 #c9d1d9로 변경된다
  And: 설정 창 하단에 "설정이 저장되었습니다" 메시지가 표시된다
  And: electron-store에 theme: "dark"가 저장된다
```

**TC-6-02: Ctrl+F 문서 내 검색**

```
Given: 뷰어 창이 열려 있고 "Hello World" 텍스트가 포함된 문서가 렌더링된 상태
When: Ctrl+F (Windows/Linux) 또는 Cmd+F (macOS)를 누른다
Then: Electron 내장 findInPage 검색 바가 창 상단에 표시된다
  And: "Hello"를 검색하면 해당 텍스트가 하이라이트된다
  And: Esc를 누르면 검색 바가 닫힌다
```

### 예외 케이스

**TC-6-03: 유효하지 않은 설정값 (fontSize 범위 외)**

```
Given: 설정 창이 열려 있는 상태
When: fontSize 필드에 0을 입력하고 "저장" 버튼을 클릭한다
Then: fontSize가 기본값 16으로 대체되어 저장된다
  And: 폼 필드가 16으로 업데이트된다
  And: 뷰어 창의 폰트 크기는 16px로 유지된다
  And: 에러 메시지 없이 정상 저장 처리된다
```

**TC-6-04: javascript: URL 클릭 차단**

```
Given: 뷰어에 악성 Markdown이 렌더링된 상태:
       - DOMPurify를 우회하여 어떤 방식으로든 javascript: URL이 잔존한다고 가정
When: 해당 링크 클릭으로 doclight.openExternal('javascript:alert(1)')이 호출된다
Then: Main Process의 open-external IPC 핸들러에서 프로토콜 검증이 실패한다
  And: shell.openExternal()이 호출되지 않는다
  And: stderr에 경고 로그가 출력된다
  And: 뷰어 창에 아무런 변화가 없다
```

### 경계값 테스트

**TC-6-05: sidebarWidth 최소값 (150px)**

```
Given: 설정에서 sidebarWidth를 150으로 설정하고 저장한 상태
When: 링크가 있는 문서를 open_markdown(filePath)로 열어 사이드바가 표시된다
Then: 사이드바 너비가 정확히 150px이다
  And: 사이드바 내 트리 항목이 텍스트 오버플로우 없이 ellipsis로 처리된다
  And: 리사이즈 핸들로 150px 미만으로 줄이려 해도 150px에서 멈춘다
```

---

## 회귀 테스트 체크리스트

- [ ] Phase 4 확인: 설정 변경 (테마/폰트) 후 렌더링 파이프라인(marked → DOMPurify → mermaid → hljs)이 정상 동작
- [ ] Phase 5 확인: 설정에서 maxRecursionDepth 변경 후 buildLinkTree가 새 깊이 제한을 준수
- [ ] Phase 3 확인: MCP Bridge의 open_markdown/update_markdown/close_viewer/list_viewers 4개 도구가 패키징 후에도 정상 동작
- [ ] Phase 2 확인: 싱글 인스턴스 락 + 트레이 아이콘 + IPC 소켓 서버가 패키징된 바이너리에서 정상 동작

---

## 테스트 코드 템플릿

```javascript
// test/e2e/settings.test.js (pseudocode — Playwright Electron 기반)

const { _electron: electron } = require('playwright');
const path = require('path');

describe('Settings Management', () => {
  let app;

  beforeAll(async () => {
    app = await electron.launch({ args: [path.join(__dirname, '../../src/main/index.js')] });
  });

  afterAll(async () => {
    await app.close();
  });

  describe('TC-6-01: 테마 변경 즉시 반영', () => {
    it('should broadcast theme change to all viewer windows', async () => {
      // Given: 뷰어 2개 열기
      // (IPC 소켓을 통해 open_markdown 2회 호출)

      // Given: 설정 창 열기
      // (트레이 메뉴 클릭 시뮬레이션 또는 IPC 직접 호출)
      const settingsPage = await app.windows()[app.windows().length - 1];

      // When: 테마를 dark로 변경 + 저장
      await settingsPage.selectOption('#theme-select', 'dark');
      await settingsPage.click('#save-button');

      // Then: 뷰어 창들의 data-theme 확인
      const viewerPages = (await app.windows()).filter(w => w.url().includes('viewer.html'));
      for (const viewer of viewerPages) {
        const theme = await viewer.getAttribute('html', 'data-theme');
        expect(theme).toBe('dark');
      }

      // Then: 저장 확인 메시지
      const msg = await settingsPage.textContent('#save-message');
      expect(msg).toContain('저장');
    });
  });

  describe('TC-6-03: 유효하지 않은 fontSize', () => {
    it('should replace invalid fontSize with default value 16', async () => {
      const settingsPage = await app.windows().find(w => w.url().includes('settings.html'));

      // When: fontSize를 0으로 설정
      await settingsPage.fill('#fontSize-input', '0');
      await settingsPage.click('#save-button');

      // Then: 필드가 16으로 대체됨
      const value = await settingsPage.inputValue('#fontSize-input');
      expect(value).toBe('16');
    });
  });

  describe('TC-6-04: javascript: URL 차단', () => {
    it('should block javascript: protocol in openExternal', async () => {
      // Given: 뷰어 창 확보
      const viewer = await app.firstWindow();

      // When: openExternal에 javascript: URL 전달
      const result = await viewer.evaluate(() => {
        window.doclight.openExternal('javascript:alert(1)');
        return true; // 에러 없이 무시되어야 함
      });

      // Then: 시스템 브라우저가 열리지 않음 (확인 방법: 부수 효과 없음)
      expect(result).toBe(true);

      // Then: 콘솔에 경고 로그 확인 (Main Process stderr)
      // (별도 로그 캡처 메커니즘 필요)
    });
  });

  describe('TC-6-05: sidebarWidth 최소값', () => {
    it('should enforce minimum sidebar width of 150px', async () => {
      // Given: sidebarWidth를 150으로 설정
      // (electron-store 직접 설정 또는 설정 UI 경유)

      // When: 링크 있는 문서 열기
      const viewer = await app.firstWindow();

      // Then: 사이드바 너비 확인
      const sidebarWidth = await viewer.evaluate(() => {
        const sidebar = document.getElementById('sidebar-container');
        return sidebar ? sidebar.offsetWidth : 0;
      });
      expect(sidebarWidth).toBe(150);
    });
  });
});

// test/e2e/security.test.js (pseudocode)

describe('Security Validation', () => {
  describe('DOMPurify', () => {
    it('should remove script tags from rendered markdown', async () => {
      // Given: open_markdown with content containing <script>
      // Then: no script elements in #content
    });
  });

  describe('CSP', () => {
    it('should block inline scripts via CSP', async () => {
      // Given: viewer loaded
      // When: attempt to execute inline script
      // Then: CSP violation error in console
    });
  });

  describe('IPC Socket Permissions', () => {
    it('should have 0o600 permissions on Unix socket', async () => {
      // Given: app running on macOS/Linux
      // When: check /tmp/doclight-ipc.sock permissions
      // Then: permissions are 0o600
    });
  });
});

// test/e2e/performance.test.js (pseudocode)

describe('Performance Validation', () => {
  it('should open window within 500ms', async () => {
    const start = Date.now();
    // open_markdown 호출
    // window-ready 대기
    const elapsed = Date.now() - start;
    expect(elapsed).toBeLessThan(500);
  });

  it('should render 100KB document within 200ms', async () => {
    const largeContent = '# Title\n' + 'paragraph text.\n'.repeat(6000);
    // open_markdown with largeContent
    // render 완료 타이밍 측정
    // expect < 200ms
  });

  it('should build link tree for 10 files within 500ms', async () => {
    // 10개 파일 연결된 테스트 셋
    const start = Date.now();
    // buildLinkTree 호출
    const elapsed = Date.now() - start;
    expect(elapsed).toBeLessThan(500);
  });
});
```

---

## 구현 순서

1. electron-store 스키마 정의 + 초기화 (6.1)
2. preload.js 확장 — 설정/줌/always-on-top API (6.1, 6.2)
3. 설정 UI 페이지 생성 (settings.html + settings.js + settings.css) (6.1)
4. 설정 창 BrowserWindow 생성 + 트레이 메뉴 연결 (6.1)
5. 설정 저장/로드 IPC 핸들러 + 브로드캐스트 (6.1)
6. 키보드 단축키 완성 (줌, Esc always-on-top 해제) (6.2)
7. electron-builder.yml 작성 + package.json 수정 (6.3)
8. 빌드 테스트: `npm run build` → 설치 파일 생성 확인 (6.3)
9. 성능 검증 (6.6)
10. 보안 검증 (6.7)
11. CLAUDE.md 재작성 (6.4)
12. README.md 재작성 (6.5)
13. 기존 Express 코드 일괄 정리/삭제 (제거 대상 코드 섹션 참조)
14. 최종 통합 테스트 (모든 Phase 기능 E2E)

---

## 예상 파일 구조 (신규/수정)

```
src/main/
├── index.js                 # [수정] electron-store 초기화, 설정 IPC 핸들러, 줌 IPC
├── window-manager.js        # [수정] 설정 창 생성, 설정 브로드캐스트
└── preload.js               # [수정] 설정/줌/always-on-top API 추가

src/renderer/
├── settings.html            # [신규] 설정 페이지
├── settings.js              # [신규] 설정 폼 로직
├── settings.css             # [신규] 설정 폼 스타일
├── viewer.js                # [수정] 줌/Esc 단축키, onSettingsChanged 핸들러
└── viewer.css               # [수정] 설정 반영 (폰트 등)

electron-builder.yml         # [신규] 패키징 설정
package.json                 # [수정] 진입점, 스크립트, 의존성 전면 교체
CLAUDE.md                    # [재작성] Electron 아키텍처 기반
README.md                    # [재작성] 사용자 가이드
```

---

## 완료 기준

- [ ] 설정 UI에서 모든 항목 변경/저장/초기화 동작
- [ ] 테마 변경 시 열린 모든 뷰어 창에 즉시 반영
- [ ] 유효 범위 외 설정값이 기본값으로 대체됨
- [ ] 모든 키보드 단축키가 SRS 표대로 동작
- [ ] electron-builder로 Windows/macOS/Linux 설치 파일 생성 가능
- [ ] MCP Bridge가 `doclight-mcp` CLI로 실행 가능
- [ ] 성능 목표 달성 (창 < 500ms, 렌더링 < 200ms, 트리 < 500ms)
- [ ] 보안 검증 통과 (DOMPurify, CSP, URL 화이트리스트, 소켓 퍼미션)
- [ ] CLAUDE.md와 README.md가 Electron 아키텍처를 반영
- [ ] 기존 Express 코드 전부 제거되고 `src/main/` + `src/renderer/`만 남음
