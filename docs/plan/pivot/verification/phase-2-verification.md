# Phase 2 검증: Electron Main Process

검증일: ____-__-__
검증자: ________________

## 참조 문서

- 구현 계획: [02.phase-2-electron-main.md](../02.phase-2-electron-main.md)
- SRS: [srs.pivot.md](../../srs.pivot.md) (FR-P-001, FR-P-003)
- 아키텍처: [00-1.architecture.md](../00-1.architecture.md) Section 2.1, 3.1

---

## 1. Electron 앱 시작 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 1 | [ ] `npm start` (electron .) 실행 성공 | 프로세스 시작, 에러 없음 | Electron 프로세스 활성 | |
| 2 | [ ] 시스템 트레이에 아이콘 표시 | 트레이 영역 육안 확인 | DocLight 아이콘 존재 | |
| 3 | [ ] 트레이 아이콘이 `assets/icon.png` 사용 | 아이콘 모양 확인 | 프로젝트 아이콘과 동일 | |
| 4 | [ ] 메인 윈도우 생성하지 않음 | 작업 표시줄에 창 없음 | 트레이 전용 (창 0개) | |

### SRS 매핑: T-01 (앱 실행 시 트레이 아이콘 표시)

---

## 2. 싱글 인스턴스 락 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 5 | [ ] `app.requestSingleInstanceLock()` 구현 | 코드 검사 (index.js) | 락 획득 로직 존재 | |
| 6 | [ ] 첫 번째 인스턴스 정상 실행 | `npm start` | 앱 시작됨 | |
| 7 | [ ] 두 번째 인스턴스 실행 시 중복 방지 | 별도 터미널에서 `npm start` 재실행 | 두 번째 인스턴스 즉시 종료, 첫 번째 유지 | |
| 8 | [ ] 두 번째 인스턴스 시도 시 기존 인스턴스 알림 | `second-instance` 이벤트 처리 | 로그 출력 또는 트레이 알림 | |

### SRS 매핑: T-02 (중복 실행 방지)

---

## 3. IPC 소켓 서버 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 9 | [ ] IPC 소켓 서버 리스닝 시작 | 앱 시작 후 로그 확인 | "IPC socket server listening" 메시지 | |
| 10 | [ ] Windows Named Pipe 경로 | 코드 확인 | `\\.\pipe\doclight-ipc` | |
| 11 | [ ] macOS/Linux Unix Socket 경로 | 코드 확인 | `/tmp/doclight-ipc.sock` | |
| 12 | [ ] Stale 소켓 파일 정리 (Unix) | 이전 소켓 파일 남겨두고 재시작 | 정상 시작 (stale 파일 삭제 후 리스닝) | |
| 13 | [ ] ndjson 프레이밍 구현 | 코드 검사 | `\n` 구분 JSON 파싱 로직 존재 | |
| 14 | [ ] 외부 클라이언트 연결 테스트 | `node -e "net.connect(PIPE_PATH)"` | 연결 성공 | |

### SRS 매핑: T-35 (IPC 소켓 통신), T-59 (ndjson 프레이밍), T-61 (stale 파일 정리)

---

## 4. 트레이 컨텍스트 메뉴 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 15 | [ ] 트레이 아이콘 우클릭 시 메뉴 표시 | 트레이 아이콘 우클릭 | 컨텍스트 메뉴 팝업 | |
| 16 | [ ] "열린 창 목록" 섹션 존재 | 메뉴 항목 확인 | 동적 창 목록 영역 (초기: 비어있음) | |
| 17 | [ ] "모든 창 닫기" 메뉴 항목 | 메뉴 항목 확인 | 항목 존재 | |
| 18 | [ ] "설정" 메뉴 항목 | 메뉴 항목 확인 | 항목 존재 | |
| 19 | [ ] "DocLight 종료" 메뉴 항목 | 메뉴 항목 확인 | 항목 존재 | |
| 20 | [ ] 구분선 정상 표시 | 메뉴 레이아웃 확인 | SRS FR-P-001 메뉴 구조와 일치 | |

### SRS 매핑: T-21 (모든 창 닫기), T-22 (종료), T-54 (창 포커스)

---

## 5. WindowManager 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 21 | [ ] `window-manager.js` 파일 존재 | 파일 확인 | `src/main/window-manager.js` 존재 | |
| 22 | [ ] `createWindow()` 메서드 구현 | 코드 검사 | BrowserWindow 생성 로직 | |
| 23 | [ ] `closeWindow()` 메서드 구현 | 코드 검사 | 개별/전체 닫기 로직 | |
| 24 | [ ] `updateWindow()` 메서드 구현 | 코드 검사 | 기존 창 내용 갱신 로직 | |
| 25 | [ ] `listWindows()` 메서드 구현 | 코드 검사 | Map에서 창 목록 반환 | |
| 26 | [ ] `Map<string, {win, meta}>` 구조 | 코드 검사 | windowId 기반 관리 | |
| 27 | [ ] UUID v4 windowId 생성 | 코드 검사 | `uuid` 또는 `crypto.randomUUID()` 사용 | |
| 28 | [ ] 캐스케이딩 위치 (x+30, y+30) | 창 2개 생성 후 위치 확인 | 두 번째 창이 오프셋 적용 | |
| 29 | [ ] 창 닫힘 시 Map에서 자동 제거 | 창 닫은 후 `listWindows()` | 목록에서 제거됨 | |
| 30 | [ ] NavigationHistory 구현 | 코드 검사 | push/back/forward, MAX_SIZE 50 | |

### SRS 매핑: T-11 (다중 창), T-43 (캐스케이딩)

---

## 6. preload.js 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 31 | [ ] `preload.js` 파일 존재 | 파일 확인 | `src/main/preload.js` 존재 | |
| 32 | [ ] `contextBridge.exposeInMainWorld` 사용 | 코드 검사 | `doclight` 네임스페이스 노출 | |
| 33 | [ ] `onRenderMarkdown` API 노출 | 코드 검사 | 렌더러→메인 IPC 콜백 등록 | |
| 34 | [ ] `onSidebarTree` API 노출 | 코드 검사 | 사이드바 트리 수신 API | |
| 35 | [ ] `navigateTo(path)` API 노출 | 코드 검사 | 사이드바 네비게이션 요청 | |
| 36 | [ ] `navigateBack()` / `navigateForward()` 노출 | 코드 검사 | 히스토리 네비게이션 API | |
| 37 | [ ] `windowReady()` API 노출 | 코드 검사 | 렌더러 준비 완료 알림 | |
| 38 | [ ] `contextIsolation: true` 설정 | BrowserWindow 옵션 확인 | 보안 격리 활성 | |
| 39 | [ ] `nodeIntegration: false` 설정 | BrowserWindow 옵션 확인 | Node.js API 비노출 | |
| 40 | [ ] `sandbox: true` 설정 | BrowserWindow 옵션 확인 | 샌드박스 활성 | |

---

## 7. Graceful Shutdown 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 41 | [ ] 트레이 → "DocLight 종료" 클릭 | 메뉴에서 종료 선택 | 앱 완전 종료 | |
| 42 | [ ] 종료 시 열린 창 모두 닫힘 | 창 열어둔 상태에서 종료 | 모든 BrowserWindow 닫힘 | |
| 43 | [ ] 종료 시 IPC 소켓 서버 정리 | 종료 후 소켓 파일 확인 | 소켓 파일 없음 (Unix) 또는 파이프 해제 (Windows) | |
| 44 | [ ] `app.before-quit` 이벤트 처리 | 코드 검사 | 정리 로직 존재 | |
| 45 | [ ] 창 모두 닫혀도 앱 종료 안 됨 | 모든 창 닫기 후 트레이 확인 | 트레이 상주 유지 | |

### SRS 매핑: T-22 (종료)

---

## 8. 코드 품질 검증

### 8.1 파일 구조

| # | 검증 항목 | 결과 |
|---|-----------|------|
| 46 | [ ] `src/main/index.js` — 앱 진입점 (트레이, IPC 소켓, 생명주기) | |
| 47 | [ ] `src/main/window-manager.js` — 창 CRUD + 네비게이션 | |
| 48 | [ ] `src/main/preload.js` — contextBridge API | |
| 49 | [ ] 각 파일이 단일 책임 원칙 준수 | |

### 8.2 에러 처리

| # | 검증 항목 | 결과 |
|---|-----------|------|
| 50 | [ ] IPC 소켓 서버 에러 핸들링 | |
| 51 | [ ] BrowserWindow 생성 실패 시 에러 처리 | |
| 52 | [ ] 트레이 아이콘 리소스 없을 때 기본 아이콘 fallback | |

---

## 9. 검증 결과 요약

| 항목 | 전체 | 통과 | 실패 | 미검증 |
|------|------|------|------|--------|
| 앱 시작 | 4 | | | |
| 싱글 인스턴스 | 4 | | | |
| IPC 소켓 서버 | 6 | | | |
| 트레이 메뉴 | 6 | | | |
| WindowManager | 10 | | | |
| preload.js | 10 | | | |
| Graceful Shutdown | 5 | | | |
| 코드 품질 | 7 | | | |
| **합계** | **52** | | | |

### 최종 판정

- [ ] **PASS**: 모든 검증 항목 통과
- [ ] **FAIL**: 실패 항목 존재 -> 수정 후 재검증 필요

실패 항목 (있을 경우):

| # | 항목 | 실패 사유 | 수정 조치 |
|---|------|-----------|-----------|
| | | | |
