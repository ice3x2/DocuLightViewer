# Phase 6 검증: 설정 및 패키징

검증일: ____-__-__
검증자: ________________

## 참조 문서

- 구현 계획: [06.phase-6-settings-polish.md](../06.phase-6-settings-polish.md)
- SRS: [srs.pivot.md](../../srs.pivot.md) (FR-P-006, NFR-P-001~004)
- 아키텍처: [00-1.architecture.md](../00-1.architecture.md)

---

## 1. 설정 창 (Settings Window) 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 1 | [ ] 트레이 → "설정" 클릭 시 설정 창 열림 | 트레이 메뉴에서 선택 | 설정 BrowserWindow 표시 | |
| 2 | [ ] 설정 창 중복 열기 방지 | 이미 열린 상태에서 재클릭 | 기존 창 포커스 | |
| 3 | [ ] 테마 설정 (light/dark) | 테마 드롭다운 변경 | 즉시 프리뷰 반영 | |
| 4 | [ ] 폰트 크기 설정 | fontSize 슬라이더/입력 | 값 변경 | |
| 5 | [ ] 폰트 패밀리 설정 | fontFamily 입력 | 값 변경 | |
| 6 | [ ] 코드 테마 설정 | codeTheme 드롭다운 | 값 변경 | |
| 7 | [ ] 기본 창 크기 설정 | width/height 입력 | 값 변경 | |
| 8 | [ ] 사이드바 기본 너비 설정 | sidebarWidth 입력 | 값 변경 | |
| 9 | [ ] 최대 재귀 깊이 설정 | maxRecursionDepth 입력 | 값 변경 | |
| 10 | [ ] 저장 버튼 클릭 | 설정 변경 후 저장 | electron-store에 저장 | |

### SRS 매핑: T-62 (설정 UI 열기/변경/저장)

---

## 2. 테마 변경 브로드캐스트 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 11 | [ ] 테마 변경 시 열린 모든 뷰어에 반영 | 뷰어 3개 열어둔 상태에서 테마 변경 | 3개 모두 즉시 테마 전환 | |
| 12 | [ ] 폰트 크기 변경 시 모든 뷰어에 반영 | fontSize 변경 후 저장 | 모든 뷰어 폰트 크기 갱신 | |
| 13 | [ ] 새 뷰어 창에 현재 설정 적용 | 테마 변경 후 새 창 열기 | 새 창에 변경된 테마 적용 | |
| 14 | [ ] IPC 브로드캐스트 방식 | 코드 검사 | `BrowserWindow.getAllWindows()` 또는 WindowManager 순회 | |

---

## 3. 설정 값 검증 (Validation) 검증

| # | 검증 항목 | 테스트 입력 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 15 | [ ] fontSize 범위 제한 | 8 미만, 72 초과 | 경고 또는 클램프 | |
| 16 | [ ] sidebarWidth 범위 제한 | 150 미만, 800 초과 | 경고 또는 클램프 | |
| 17 | [ ] maxRecursionDepth 범위 제한 | 1 미만, 20 초과 | 경고 또는 클램프 | |
| 18 | [ ] defaultWindowWidth 최소값 | 400 미만 | 경고 또는 클램프 | |
| 19 | [ ] defaultWindowHeight 최소값 | 300 미만 | 경고 또는 클램프 | |
| 20 | [ ] 설정 마이그레이션 (누락 키 기본값) | 기존 store에 누락 키 | 기본값으로 보충 | |

### SRS 매핑: T-55 (설정 마이그레이션)

---

## 4. electron-builder 패키징 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 21 | [ ] `electron-builder.yml` 설정 파일 존재 | 파일 확인 | 루트에 존재 | |
| 22 | [ ] Windows 빌드 성공 (NSIS/portable) | `npm run build` (Windows) | `.exe` 인스톨러 생성 | |
| 23 | [ ] macOS 빌드 성공 (DMG) | `npm run build` (macOS) | `.dmg` 파일 생성 (해당 플랫폼에서만) | |
| 24 | [ ] Linux 빌드 성공 (AppImage) | `npm run build` (Linux) | `.AppImage` 파일 생성 (해당 플랫폼에서만) | |
| 25 | [ ] 빌드 결과물에 불필요 파일 미포함 | 빌드 산출물 검사 | docs/, test/, .git 미포함 | |
| 26 | [ ] 빌드 결과물에 필수 파일 포함 | 빌드 산출물 검사 | src/main/, src/renderer/, assets/ 포함 | |
| 27 | [ ] MCP Bridge 바이너리 별도 패키징 | bin 필드 확인 | `doclight-mcp` 실행 가능 | |

### SRS 매핑: NFR-P-003 (호환성)

---

## 5. 문서 업데이트 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 28 | [ ] CLAUDE.md 업데이트 (Electron 아키텍처) | 파일 내용 확인 | Express 참조 제거, Electron 구조 반영 | |
| 29 | [ ] README.md 재작성 | 파일 내용 확인 | 설치/사용법이 Electron + MCP 기준 | |
| 30 | [ ] MCP 클라이언트 등록 가이드 포함 | README 확인 | claude_desktop_config.json 예시 포함 | |
| 31 | [ ] package.json description 갱신 | 필드 확인 | Electron + MCP 설명 반영 | |

---

## 6. 성능 목표 검증

| # | 검증 항목 | 측정 방법 | 기준 | 결과 |
|---|-----------|-----------|------|------|
| 32 | [ ] 창 열기 시간 < 500ms | MCP open_markdown 호출 ~ 창 표시 | <= 500ms | __ms |
| 33 | [ ] Markdown 렌더링 시간 < 200ms | render-markdown IPC ~ DOM 완성 | <= 200ms | __ms |
| 34 | [ ] 사이드바 트리 빌드 시간 (10개 파일) | buildLinkTree 실행 시간 | <= 500ms | __ms |
| 35 | [ ] 사이드바 트리 빌드 시간 (100개 파일) | buildLinkTree 실행 시간 | <= 2000ms | __ms |
| 36 | [ ] 메모리 사용 (뷰어 1개) | Electron 프로세스 메모리 | 합리적 범위 | __MB |
| 37 | [ ] 메모리 사용 (뷰어 10개) | Electron 프로세스 메모리 | 선형 증가 확인 | __MB |

### SRS 매핑: NFR-P-001 (성능), NFR-P-004 (리소스 사용)

---

## 7. 보안 테스트 검증

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 38 | [ ] DOMPurify 활성 (모든 뷰어) | `<script>` 주입 테스트 | 스크립트 제거됨 | |
| 39 | [ ] CSP meta 태그 적용 | viewer.html 검사 | `script-src 'self'` | |
| 40 | [ ] shell.openExternal URL 화이트리스트 | `javascript:` URL 테스트 | http/https만 허용 | |
| 41 | [ ] contextIsolation: true | BrowserWindow 옵션 | 보안 격리 활성 | |
| 42 | [ ] nodeIntegration: false | BrowserWindow 옵션 | Node.js API 비노출 | |
| 43 | [ ] sandbox: true | BrowserWindow 옵션 | 샌드박스 활성 | |
| 44 | [ ] preload 스크립트 최소 API 노출 | preload.js 검사 | doclight 네임스페이스만 노출, fs/child_process 등 미노출 | |

### SRS 매핑: NFR-P-002 (보안)

---

## 8. 중복/죽은 코드 최종 검사

| # | 검증 항목 | 확인 방법 | 기대 결과 | 결과 |
|---|-----------|-----------|-----------|------|
| 45 | [ ] Express 코드 잔재 0개 | `grep -r "express" src/` | 0건 (docs/ 제외) | |
| 46 | [ ] 미사용 npm 패키지 0개 | `npx depcheck` | 미사용 dependency 0건 | |
| 47 | [ ] 렌더링 로직 단일 파일 (viewer.js) | src/ 검색 | viewer.js에만 렌더링 코드 | |
| 48 | [ ] lib/ 중복 없음 | npm list + src/renderer/lib/ 비교 | 라이브러리 중복 설치 없음 (marked 제외: link-parser용) | |
| 49 | [ ] 유틸리티 과도 추출 없음 | src/ 파일 수 확인 | 계획 대비 불필요 파일 0개 | |

---

## 9. 검증 결과 요약

| 항목 | 전체 | 통과 | 실패 | 미검증 |
|------|------|------|------|--------|
| 설정 창 | 10 | | | |
| 테마 브로드캐스트 | 4 | | | |
| 설정 값 검증 | 6 | | | |
| 패키징 | 7 | | | |
| 문서 업데이트 | 4 | | | |
| 성능 목표 | 6 | | | |
| 보안 테스트 | 7 | | | |
| 중복/죽은 코드 | 5 | | | |
| **합계** | **49** | | | |

### 최종 판정

- [ ] **PASS**: 모든 검증 항목 통과
- [ ] **FAIL**: 실패 항목 존재 -> 수정 후 재검증 필요

실패 항목 (있을 경우):

| # | 항목 | 실패 사유 | 수정 조치 |
|---|------|-----------|-----------|
| | | | |
