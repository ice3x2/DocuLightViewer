# Phase 5: íŒŒì¼ ê´€ë¦¬ ê¸°ëŠ¥

| í•­ëª© | ë‚´ìš© |
|------|------|
| **Phase** | 5 |
| **ì˜ˆìƒ ì‹œê°„** | 13ì‹œê°„ |
| **ì„ í–‰ ì¡°ê±´** | Phase 3, 4 ì™„ë£Œ |
| **ê´€ë ¨ ìš”êµ¬ì‚¬í•­** | REQ-SEL-001~004, REQ-CTX-001~006, REQ-FILE-001~003 |

---

## 1. ëª©í‘œ ë° ë²”ìœ„

### 1.1 ëª©í‘œ

- ë‹¤ì¤‘ ì„ íƒ ê¸°ëŠ¥ (Shift, Ctrl í´ë¦­)
- ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ (ìš°í´ë¦­ ë©”ë‰´)
- íŒŒì¼/í´ë” ì‚­ì œ, ì´ë¦„ ë³€ê²½ UI
- ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸ ì‹œìŠ¤í…œ

### 1.2 ë²”ìœ„

**í¬í•¨:**
- SelectionModule (ë‹¨ì¼/ë‹¤ì¤‘ ì„ íƒ)
- ContextMenuModule (ìš°í´ë¦­ ë©”ë‰´)
- ModalModule (ëª¨ë‹¬ ê´€ë¦¬)
- RenameModal, DeleteConfirmModal

**ì œì™¸:**
- íŒŒì¼ í¸ì§‘ (Phase 6)
- ë“œë˜ê·¸ì•¤ë“œë¡­ (Phase 7)

---

## 2. ì•„í‚¤í…ì²˜ ì°¸ì¡°

> ì°¸ì¡°: [00-1.architecture.md](00-1.architecture.md) - 3.3.3 UI ìƒì„¸ ì„¤ê³„

### 2.1 ê´€ë ¨ ì»´í¬ë„ŒíŠ¸

```
public/js/admin.js   â† SelectionModule, ContextMenuModule, ModalModule ì¶”ê°€
public/css/admin.css â† ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´, ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ì¶”ê°€
```

---

## 3. êµ¬í˜„ í•­ëª© ì²´í¬ë¦¬ìŠ¤íŠ¸

### 3.1 SelectionModule

- [ ] **TASK-501**: handleClick() ê¸°ë³¸ ì„ íƒ
  - ë‹¨ì¼ í´ë¦­ â†’ ë‹¨ì¼ ì„ íƒ
  - selectedPaths ì—…ë°ì´íŠ¸

- [ ] **TASK-502**: handleShiftClick() ë²”ìœ„ ì„ íƒ
  - lastSelectedIndex ~ currentIndex ë²”ìœ„ ì„ íƒ
  - flattenTree()ë¡œ ì¸ë±ìŠ¤ ê³„ì‚°

- [ ] **TASK-503**: handleCtrlClick() í† ê¸€ ì„ íƒ
  - ì„ íƒ ìƒíƒœ í† ê¸€
  - ê¸°ì¡´ ì„ íƒ ìœ ì§€

- [ ] **TASK-504**: selectAll() ì „ì²´ ì„ íƒ
  - Ctrl+A ë°”ì¸ë”©
  - í˜„ì¬ ë³´ì´ëŠ” í•­ëª© ì „ì²´ ì„ íƒ

- [ ] **TASK-505**: clearSelection() ì„ íƒ í•´ì œ

### 3.2 ContextMenuModule

- [ ] **TASK-506**: showContextMenu(x, y, targetPath, targetType)
  - ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì— ë©”ë‰´ í‘œì‹œ
  - íƒ€ì…(file/directory)ì— ë”°ë¼ ë©”ë‰´ í•­ëª© ë‹¤ë¦„

- [ ] **TASK-507**: hideContextMenu()
  - ë©”ë‰´ ì œê±°
  - document í´ë¦­ ì‹œ ìë™ ìˆ¨ê¹€

- [ ] **TASK-508**: buildMenuItems(targetPath, targetType)
  - íŒŒì¼: Edit, Rename, Cut, Copy, Delete
  - í´ë”: New File, New Folder, Rename, Cut, Copy, Paste, Delete

- [ ] **TASK-509**: handleMenuAction(action, targetPath)
  - ì•¡ì…˜ë³„ ì²˜ë¦¬ (edit, rename, delete, cut, copy, paste, newFile, newFolder)

- [ ] **TASK-510**: ìš°í´ë¦­ ì´ë²¤íŠ¸ ë°”ì¸ë”©
  - contextmenu ì´ë²¤íŠ¸ì—ì„œ ê¸°ë³¸ ë™ì‘ ë°©ì§€
  - showContextMenu() í˜¸ì¶œ

### 3.3 ModalModule

- [ ] **TASK-511**: showModal(modalId)
  - ëª¨ë‹¬ í‘œì‹œ
  - ë°°ê²½ ì˜¤ë²„ë ˆì´

- [ ] **TASK-512**: hideModal(modalId)
  - ëª¨ë‹¬ ìˆ¨ê¹€
  - ESC í‚¤ë¡œ ë‹«ê¸°

- [ ] **TASK-513**: confirmAction(message) â†’ Promise
  - í™•ì¸/ì·¨ì†Œ ë‹¤ì´ì–¼ë¡œê·¸
  - Promise ë°˜í™˜

### 3.4 RenameModal

- [ ] **TASK-514**: ë§ˆí¬ì—… ì¶”ê°€
  - í˜„ì¬ ì´ë¦„ í‘œì‹œ
  - ìƒˆ ì´ë¦„ ì…ë ¥ í•„ë“œ
  - ì €ì¥/ì·¨ì†Œ ë²„íŠ¼

- [ ] **TASK-515**: showRenameModal(path, currentName)
  - ëª¨ë‹¬ í‘œì‹œ
  - ì…ë ¥ í•„ë“œì— í˜„ì¬ ì´ë¦„

- [ ] **TASK-516**: handleRename()
  - API í˜¸ì¶œ (PUT /api/admin/rename)
  - íŠ¸ë¦¬ ìƒˆë¡œê³ ì¹¨

### 3.5 DeleteConfirmModal

- [ ] **TASK-517**: ë§ˆí¬ì—… ì¶”ê°€
  - ì‚­ì œí•  í•­ëª© ëª©ë¡
  - í™•ì¸/ì·¨ì†Œ ë²„íŠ¼

- [ ] **TASK-518**: showDeleteConfirm(paths)
  - ëª¨ë‹¬ í‘œì‹œ
  - ì‚­ì œ ëŒ€ìƒ ëª©ë¡ í‘œì‹œ

- [ ] **TASK-519**: handleDelete()
  - API í˜¸ì¶œ (DELETE /api/admin/entry)
  - íŠ¸ë¦¬ ìƒˆë¡œê³ ì¹¨

### 3.6 CreateModal

- [ ] **TASK-520**: ë§ˆí¬ì—… ì¶”ê°€
  - ì´ë¦„ ì…ë ¥ í•„ë“œ
  - íƒ€ì… ì„ íƒ (file/directory)
  - ìƒì„±/ì·¨ì†Œ ë²„íŠ¼

- [ ] **TASK-521**: showCreateModal(parentPath, type)
  - ëª¨ë‹¬ í‘œì‹œ
  - íƒ€ì…ì— ë”°ë¼ UI ì¡°ì •

- [ ] **TASK-522**: handleCreate()
  - API í˜¸ì¶œ (POST /api/admin/create)
  - íŠ¸ë¦¬ ìƒˆë¡œê³ ì¹¨

### 3.7 í´ë¦½ë³´ë“œ

- [ ] **TASK-523**: cut(paths)
  - clipboard = { operation: 'cut', paths }

- [ ] **TASK-524**: copy(paths)
  - clipboard = { operation: 'copy', paths }

- [ ] **TASK-525**: paste(targetDirectory)
  - cut â†’ move API í˜¸ì¶œ
  - copy â†’ (ë¯¸êµ¬í˜„, í–¥í›„ í™•ì¥)

### 3.8 í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤

- [ ] **TASK-526**: Delete í‚¤ â†’ ì‚­ì œ í™•ì¸
- [ ] **TASK-527**: F2 í‚¤ â†’ ì´ë¦„ ë³€ê²½
- [ ] **TASK-528**: Ctrl+A â†’ ì „ì²´ ì„ íƒ
- [ ] **TASK-529**: Escape â†’ ëª¨ë‹¬ ë‹«ê¸° / ì„ íƒ í•´ì œ

---

## 4. ìƒì„¸ êµ¬í˜„ ëª…ì„¸

### 4.1 SelectionModule

```javascript
const SelectionModule = {
  flatList: [],  // íŠ¸ë¦¬ë¥¼ í‰íƒ„í™”í•œ ë°°ì—´

  flattenTree(nodes, list = []) {
    for (const node of nodes) {
      list.push(node);
      if (node.children && AdminState.expandedPaths.has(node.path)) {
        this.flattenTree(node.children, list);
      }
    }
    return list;
  },

  getIndex(path) {
    return this.flatList.findIndex(n => n.path === path);
  },

  handleClick(path, event) {
    this.flatList = this.flattenTree(AdminState.fileTree);

    if (event.shiftKey && AdminState.lastSelectedPath) {
      this.handleShiftClick(path);
    } else if (event.ctrlKey || event.metaKey) {
      this.handleCtrlClick(path);
    } else {
      AdminState.selectedPaths = [path];
      AdminState.lastSelectedPath = path;
    }

    TreeModule.updateSelection();
  },

  handleShiftClick(path) {
    const startIndex = this.getIndex(AdminState.lastSelectedPath);
    const endIndex = this.getIndex(path);

    if (startIndex === -1 || endIndex === -1) return;

    const [from, to] = startIndex < endIndex
      ? [startIndex, endIndex]
      : [endIndex, startIndex];

    AdminState.selectedPaths = this.flatList
      .slice(from, to + 1)
      .map(n => n.path);
  },

  handleCtrlClick(path) {
    const index = AdminState.selectedPaths.indexOf(path);
    if (index === -1) {
      AdminState.selectedPaths.push(path);
    } else {
      AdminState.selectedPaths.splice(index, 1);
    }
    AdminState.lastSelectedPath = path;
  },

  selectAll() {
    this.flatList = this.flattenTree(AdminState.fileTree);
    AdminState.selectedPaths = this.flatList.map(n => n.path);
    TreeModule.updateSelection();
  },

  clearSelection() {
    AdminState.selectedPaths = [];
    AdminState.lastSelectedPath = null;
    TreeModule.updateSelection();
  }
};
```

### 4.2 ContextMenuModule

```javascript
const ContextMenuModule = {
  menuElement: null,

  showContextMenu(x, y, targetPath, targetType) {
    this.hideContextMenu();

    const menu = document.createElement('div');
    menu.className = 'context-menu';
    menu.style.left = `${x}px`;
    menu.style.top = `${y}px`;

    const items = this.buildMenuItems(targetPath, targetType);
    for (const item of items) {
      if (item.separator) {
        const sep = document.createElement('div');
        sep.className = 'context-menu-separator';
        menu.appendChild(sep);
      } else {
        const menuItem = document.createElement('div');
        menuItem.className = 'context-menu-item';
        if (item.disabled) menuItem.classList.add('disabled');
        menuItem.innerHTML = `<span class="menu-icon">${item.icon}</span>${item.label}`;
        menuItem.addEventListener('click', () => {
          if (!item.disabled) {
            this.handleMenuAction(item.action, targetPath);
          }
          this.hideContextMenu();
        });
        menu.appendChild(menuItem);
      }
    }

    document.body.appendChild(menu);
    this.menuElement = menu;

    // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
    const rect = menu.getBoundingClientRect();
    if (rect.right > window.innerWidth) {
      menu.style.left = `${window.innerWidth - rect.width - 8}px`;
    }
    if (rect.bottom > window.innerHeight) {
      menu.style.top = `${window.innerHeight - rect.height - 8}px`;
    }
  },

  hideContextMenu() {
    if (this.menuElement) {
      this.menuElement.remove();
      this.menuElement = null;
    }
  },

  buildMenuItems(targetPath, targetType) {
    const hasWritePermission = AdminState.session?.permissions.includes('write');
    const hasDeletePermission = AdminState.session?.permissions.includes('delete');
    const hasClipboard = AdminState.clipboard !== null;

    if (targetType === 'directory') {
      return [
        { icon: 'ğŸ“„', label: 'New File', action: 'newFile', disabled: !hasWritePermission },
        { icon: 'ğŸ“', label: 'New Folder', action: 'newFolder', disabled: !hasWritePermission },
        { separator: true },
        { icon: 'ğŸ“', label: 'Rename', action: 'rename', disabled: !hasWritePermission },
        { separator: true },
        { icon: 'âœ‚ï¸', label: 'Cut', action: 'cut', disabled: !hasWritePermission },
        { icon: 'ğŸ“‹', label: 'Copy', action: 'copy' },
        { icon: 'ğŸ“‹', label: 'Paste', action: 'paste', disabled: !hasWritePermission || !hasClipboard },
        { separator: true },
        { icon: 'ğŸ—‘ï¸', label: 'Delete', action: 'delete', disabled: !hasDeletePermission }
      ];
    } else {
      const isEditable = this.isEditable(targetPath);
      return [
        { icon: 'âœï¸', label: 'Edit', action: 'edit', disabled: !isEditable },
        { icon: 'ğŸ“', label: 'Rename', action: 'rename', disabled: !hasWritePermission },
        { separator: true },
        { icon: 'âœ‚ï¸', label: 'Cut', action: 'cut', disabled: !hasWritePermission },
        { icon: 'ğŸ“‹', label: 'Copy', action: 'copy' },
        { separator: true },
        { icon: 'ğŸ—‘ï¸', label: 'Delete', action: 'delete', disabled: !hasDeletePermission }
      ];
    }
  },

  isEditable(path) {
    const editableExtensions = ['.md', '.txt', '.json', '.json5', '.yaml', '.yml'];
    return editableExtensions.some(ext => path.toLowerCase().endsWith(ext));
  },

  handleMenuAction(action, targetPath) {
    switch (action) {
      case 'edit':
        EditorModule.openEditor(targetPath);
        break;
      case 'rename':
        ModalModule.showRenameModal(targetPath);
        break;
      case 'delete':
        ModalModule.showDeleteConfirm(AdminState.selectedPaths.length > 0
          ? AdminState.selectedPaths
          : [targetPath]);
        break;
      case 'cut':
        ClipboardModule.cut(AdminState.selectedPaths.length > 0
          ? AdminState.selectedPaths
          : [targetPath]);
        break;
      case 'copy':
        ClipboardModule.copy(AdminState.selectedPaths.length > 0
          ? AdminState.selectedPaths
          : [targetPath]);
        break;
      case 'paste':
        ClipboardModule.paste(targetPath);
        break;
      case 'newFile':
        ModalModule.showCreateModal(targetPath, 'file');
        break;
      case 'newFolder':
        ModalModule.showCreateModal(targetPath, 'directory');
        break;
    }
  }
};

// ì „ì—­ í´ë¦­ìœ¼ë¡œ ë©”ë‰´ ë‹«ê¸°
document.addEventListener('click', () => ContextMenuModule.hideContextMenu());
```

### 4.3 CSS ì¶”ê°€

```css
/* Context Menu */
.context-menu {
  position: fixed;
  background: white;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  min-width: 160px;
  z-index: 1000;
  padding: 4px 0;
}

.context-menu-item {
  display: flex;
  align-items: center;
  padding: 8px 12px;
  cursor: pointer;
  font-size: 14px;
}

.context-menu-item:hover {
  background: #f0f0f0;
}

.context-menu-item.disabled {
  color: #999;
  cursor: not-allowed;
}

.context-menu-item.disabled:hover {
  background: none;
}

.menu-icon {
  margin-right: 8px;
}

.context-menu-separator {
  height: 1px;
  background: var(--border-color);
  margin: 4px 0;
}

/* Multi-select highlight */
.tree-item.selected {
  background: var(--selected-bg);
}

.tree-item.cut {
  opacity: 0.5;
}
```

---

## 5. í…ŒìŠ¤íŠ¸ ì„¹ì…˜

### 5.1 í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ (Playwright)

#### TC-501: ë‹¨ì¼ ì„ íƒ

```
Given: íŒŒì¼ íŠ¸ë¦¬ í‘œì‹œë¨
When: íŒŒì¼ í´ë¦­
Then: í•´ë‹¹ íŒŒì¼ë§Œ ì„ íƒë¨
And: ì´ì „ ì„ íƒ í•´ì œ
```

#### TC-502: Shift ë‹¤ì¤‘ ì„ íƒ

```
Given: íŒŒì¼ A ì„ íƒë¨
When: Shift + íŒŒì¼ C í´ë¦­
Then: A, B, C ëª¨ë‘ ì„ íƒë¨
```

#### TC-503: Ctrl í† ê¸€ ì„ íƒ

```
Given: íŒŒì¼ A ì„ íƒë¨
When: Ctrl + íŒŒì¼ B í´ë¦­
Then: A, B ëª¨ë‘ ì„ íƒë¨
When: Ctrl + íŒŒì¼ A í´ë¦­
Then: Bë§Œ ì„ íƒë¨
```

#### TC-504: ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í‘œì‹œ (íŒŒì¼)

```
Given: íŒŒì¼ íŠ¸ë¦¬ í‘œì‹œë¨
When: íŒŒì¼ ìš°í´ë¦­
Then: ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í‘œì‹œ
And: Edit, Rename, Cut, Copy, Delete ë©”ë‰´ í¬í•¨
```

#### TC-505: ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í‘œì‹œ (í´ë”)

```
Given: íŒŒì¼ íŠ¸ë¦¬ í‘œì‹œë¨
When: í´ë” ìš°í´ë¦­
Then: ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í‘œì‹œ
And: New File, New Folder, Paste ë©”ë‰´ ì¶”ê°€ í¬í•¨
```

#### TC-506: ì´ë¦„ ë³€ê²½

```
Given: ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ â†’ Rename ì„ íƒ
Then: ì´ë¦„ ë³€ê²½ ëª¨ë‹¬ í‘œì‹œ
When: ìƒˆ ì´ë¦„ ì…ë ¥ í›„ ì €ì¥
Then: íŒŒì¼ëª… ë³€ê²½ë¨
And: íŠ¸ë¦¬ ìƒˆë¡œê³ ì¹¨
```

#### TC-507: ë‹¤ì¤‘ ì‚­ì œ

```
Given: íŒŒì¼ 3ê°œ ì„ íƒë¨
When: Delete í‚¤ ë˜ëŠ” ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ â†’ Delete
Then: ì‚­ì œ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
And: 3ê°œ íŒŒì¼ ëª©ë¡ í‘œì‹œ
When: í™•ì¸ í´ë¦­
Then: 3ê°œ íŒŒì¼ ì‚­ì œë¨
```

#### TC-508: ìƒˆ íŒŒì¼ ìƒì„±

```
Given: í´ë” ìš°í´ë¦­ â†’ New File
Then: ìƒì„± ëª¨ë‹¬ í‘œì‹œ
When: ì´ë¦„ ì…ë ¥ í›„ ìƒì„±
Then: ìƒˆ íŒŒì¼ ìƒì„±ë¨
```

### 5.2 í…ŒìŠ¤íŠ¸ ì½”ë“œ êµ¬ì¡°

```javascript
// test/admin-file-management.spec.js
test.describe('File Management', () => {
  test('single selection', async ({ page }) => { /* TC-501 */ });
  test('shift multi-select', async ({ page }) => { /* TC-502 */ });
  test('ctrl toggle select', async ({ page }) => { /* TC-503 */ });
  test('context menu on file', async ({ page }) => { /* TC-504 */ });
  test('context menu on folder', async ({ page }) => { /* TC-505 */ });
  test('rename file', async ({ page }) => { /* TC-506 */ });
  test('delete multiple files', async ({ page }) => { /* TC-507 */ });
  test('create new file', async ({ page }) => { /* TC-508 */ });
});
```

---

## 6. íšŒê·€í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¡°ê±´

- [ ] Phase 1~4 í…ŒìŠ¤íŠ¸ ì „ì²´
- [ ] ì‹ ê·œ íŒŒì¼ ê´€ë¦¬ í…ŒìŠ¤íŠ¸ ì „ì²´

---

## 7. ì™„ë£Œ ì¡°ê±´

- [ ] ëª¨ë“  êµ¬í˜„ í•­ëª© ì²´í¬ë¦¬ìŠ¤íŠ¸ ì™„ë£Œ (TASK-501 ~ TASK-529)
- [ ] ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ í†µê³¼ (TC-501 ~ TC-508)
- [ ] íšŒê·€í…ŒìŠ¤íŠ¸ 100% í†µê³¼

---

*Phase 5 ë¬¸ì„œ ë*
